<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>high-level API · Korg</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Korg logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Korg</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Quickstart</a></li><li><a class="tocitem" href="../install/">Install</a></li><li class="is-active"><a class="tocitem" href>high-level API</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Secondary-functions"><span>Secondary functions</span></a></li><li><a class="tocitem" href="#Postprocessing"><span>Postprocessing</span></a></li><li><a class="tocitem" href="#Line-absorption"><span>Line absorption</span></a></li><li><a class="tocitem" href="#Continuum-absorption"><span>Continuum absorption</span></a></li><li><a class="tocitem" href="#Statistical-mechanics"><span>Statistical mechanics</span></a></li><li><a class="tocitem" href="#Misc"><span>Misc</span></a></li></ul></li><li><a class="tocitem" href="../FAQ/">FAQ</a></li><li><a class="tocitem" href="../changelog/">Changelog</a></li><li><a class="tocitem" href="../devdocs/">Developer Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>high-level API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>high-level API</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ajwheeler/Korg.jl/blob/main/docs/src/API.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p>This page docuements the Korg API for users of the package. Low-level functions that only people  digging into the internals of Korg will be interested in can be found in the  <a href="../devdocs/#Developer-documentation">Developer documentation</a>.</p><h1 id="API"><a class="docs-heading-anchor" href="#API">Top-level functions</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><p>If you are synthesize a spectrum Korg, these are the functions you will call.   These functions are exported, so if you do <code>using Korg</code>, you can call them unquallified (i.e. <code>synthesize</code> instead of <code>Korg.synthesize</code>).  </p><article class="docstring"><header><a class="docstring-binding" id="Korg.synthesize" href="#Korg.synthesize"><code>Korg.synthesize</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">synthesize(atm, linelist, A_X, λ_start, λ_stop, [λ_step=0.01]; kwargs... )
synthesize(atm, linelist, A_X, wavelength_ranges; kwargs... )</code></pre><p>Compute a synthetic spectrum.</p><p><strong>Arguments</strong></p><ul><li><code>atm</code>: the model atmosphere (see <a href="../API/#Korg.read_model_atmosphere"><code>read_model_atmosphere</code></a>)</li><li><code>linelist</code>: A vector of <a href="#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Line</code></a>s (see <a href="../API/#Korg.read_linelist"><code>read_linelist</code></a>,   <a href="#Korg.get_APOGEE_DR17_linelist-Tuple{}"><code>get_APOGEE_DR17_linelist</code></a>, and <a href="#Korg.get_VALD_solar_linelist-Tuple{}"><code>get_VALD_solar_linelist</code></a>).</li><li><code>A_X</code>: a vector containing the A(X) abundances (log(X/H) + 12) for elements from hydrogen to  uranium.  (see <a href="../API/#Korg.format_A_X"><code>format_A_X</code></a>)</li><li><code>λ_start</code>: the lower bound (in Å) of the region you wish to synthesize.</li><li><code>λ_stop</code>: the upper bound (in Å) of the region you wish to synthesize.</li><li><code>λ_step</code> (default: 0.01): the (approximate) step size to take (in Å).</li></ul><p>If you provide a vector of wavelength ranges in place of <code>λ_start</code> and <code>λ_stop</code>, the spectrum will  be synthesized over each range with minimal overhead. The ranges can be any Julia <code>AbstractRange</code>, for example: <code>5000:0.01:5010</code>.</p><p><strong>Returns</strong></p><p>A named tuple with keys:</p><ul><li><code>flux</code>: the output spectrum</li><li><code>cntm</code>: the continuum at each wavelength</li><li><code>alpha</code>: the linear absorption coefficient at each wavelenth and atmospheric layer a Matrix of   size (layers x wavelengths)</li><li><code>number_densities</code>: A dictionary mapping <code>Species</code> to vectors of number densities at each   atmospheric layer</li><li><code>electron_number_density</code>: the electron number density at each atmospheric layer</li><li><code>wavelengths</code>: The vacuum wavelenths (in Å) over which the synthesis was performed.  If  <code>air_wavelengths=true</code> this will not be the same as the input wavelenths.</li><li><code>subspectra</code>: A vector of ranges which can be used to index into <code>flux</code> to extract the spectrum   for each range provided in <code>wavelength_ranges</code>.  If you use the standard <code>λ_start</code>, <code>λ_stop</code>,   <code>λ_step</code> arguments, this will be a vector containing only one range.</li></ul><p><strong>Example</strong></p><p>to synthesize a spectrum between 5000 Å and 5100 Å, with all metal abundances set to  0.5 dex less than the solar value except carbon, except carbon, which we set to [C/H]=-0.25:</p><pre><code class="nohighlight hljs">atm = read_model_atmosphere(&quot;path/to/atmosphere.mod&quot;)
linelist = read_linelist(&quot;path/to/linelist.vald&quot;)
A_X = format_A_X(-0.5, Dict(&quot;C&quot; =&gt; -0.25))
solution = synthesize(atm, linelist, A_X, 5000, 5100)</code></pre><p><strong>Optional arguments:</strong></p><ul><li><code>vmic</code> (default: 0) is the microturbulent velocity, <span>$\xi$</span>, in km/s.</li><li><code>air_wavelengths</code> (default: <code>false</code>): Whether or not the input wavelengths are air wavelenths to   be converted to vacuum wavelengths by Korg.  The conversion will not be exact, so that the   wavelenth range can internally be represented by an evenly-spaced range.  If the approximation   error is greater than <code>wavelength_conversion_warn_threshold</code>, an error will be thrown. (To do   wavelength conversions yourself, see <a href="../API/#Korg.air_to_vacuum"><code>air_to_vacuum</code></a> and <a href="../API/#Korg.vacuum_to_air"><code>vacuum_to_air</code></a>.)</li><li><code>wavelength_conversion_warn_threshold</code> (default: 1e-4): see <code>air_wavelengths</code>. (In Å.)</li><li><code>line_buffer</code> (default: 10): the farthest (in Å) any line can be from the provided wavelenth range   before it is discarded.  If the edge of your window is near a strong line, you may have to turn   this up.</li><li><code>cntm_step</code> (default 1): the distance (in Å) between point at which the continuum opacity is  calculated.</li><li><code>hydrogen_lines</code> (default: <code>true</code>): whether or not to include H lines in the synthesis.</li><li><code>use_MHD_for_hydrogen_lines</code> (default: <code>true</code>): whether or not to use the MHD occupation   probability formalism for hydrogen lines. (MHD is always used for hydrogen bound-free absorption.)</li><li><code>hydrogen_line_window_size</code> (default: 150): the mamximum distance (in Å) from each hydrogen line   center at which to calculate its contribution to the total absorption coefficient.</li><li><code>n_mu_points</code> (default: 20): the number of μ values at which to calculate the surface flux when doing   transfer in spherical geometry (when <code>atm</code> is a <code>ShellAtmosphere</code>). 20 points is sufficient for  accuracy at the 10^-3 level.</li><li><code>line_cutoff_threshold</code> (default: <code>3e-4</code>): the fraction of the continuum absorption coefficient   at which line profiles are truncated.  This has major performance impacts, since line absorption  calculations dominate more syntheses.  Turn it down for more precision at the expense of runtime.  The default value should effect final spectra below the 10^-3 level.</li><li><code>electron_number_density_warn_threshold</code> (default: <code>1.0</code>): if the relative difference between the   calculated electron number density and the input electron number density is greater than this value,  a warning is printed.  Set to <code>Inf</code> to suppress this warning.</li><li><code>return_cntm</code> (default: <code>true</code>): whether or not to return the continuum at each wavelength.  If   this is false, <code>solution.cntm</code> will be <code>nothing</code>.</li><li><code>ionization_energies</code>, a <code>Dict</code> mapping <code>Species</code> to their first three ionization energies,   defaults to <code>Korg.ionization_energies</code>.</li><li><code>partition_funcs</code>, a <code>Dict</code> mapping <code>Species</code> to partition functions (in terms of ln(T)). Defaults   to data from Barklem &amp; Collet 2016, <code>Korg.default_partition_funcs</code>.</li><li><code>equilibrium_constants</code>, a <code>Dict</code> mapping <code>Species</code> representing diatomic molecules to the base-10  log of their molecular equilbrium constants in partial pressure form.  Defaults to data from   Barklem and Collet 2016, <code>Korg.default_log_equilibrium_constants</code>.</li><li><code>bezier_radiative_transfer</code> (default: false): Use the radiative transfer scheme.  This is for   testing purposes only.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/synthesize.jl#L5-L89">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.read_linelist" href="#Korg.read_linelist"><code>Korg.read_linelist</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_linelist(filename; format=&quot;vald&quot;, isotopic_abundances=Korg.isotopic_abundances)</code></pre><p>Parse a linelist file, returning a vector of <a href="#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Line</code></a>s.</p><p>The <code>format</code> keyword argument can be used to specify one of these linelist formats  (default: <code>&quot;vald&quot;</code>):</p><ul><li><code>&quot;vald&quot;</code> for a <a href="http://vald.astro.uu.se/~vald/php/vald.php">VALD</a> linelist.  These can be either &quot;short&quot; or &quot;long&quot; format,   &quot;extract all&quot; or &quot;extract stellar&quot;.  Air wavelengths will automatically be converted into vacuum  wavelengths, and energy levels will be automatically converted from cm<span>$^{-1}$</span> to eV.</li><li><code>&quot;kurucz&quot;</code> for an atomic or molecular <a href="http://kurucz.harvard.edu/linelists.html">Kurucz linelist</a>   (format=kurucz_vac if it uses vacuum wavelengths; be warned that Korg will not assume that   wavelengths are vacuum below 2000 Å),</li><li><code>&quot;moog&quot;</code> for a <a href="http://www.as.utexas.edu/~chris/moog.html">MOOG linelist</a>  (doesn&#39;t support broadening parameters or dissociation energies).  </li><li><code>&quot;turbospectrum&quot;</code> for a   <a href="https://github.com/bertrandplez/Turbospectrum2019/blob/master/DOC/Readme-Linelist_format_v.19">Turbospectrum linelist</a>   in air wavelengths. Note that Korg doesn&#39;t make use of the (optional) orbital angular momentum quantum number, l,   for the upper or lower levels, so it won&#39;t fall back on generic ABO recipes when the ABO   parameters are not available.  Korg&#39;s interpretation of the <code>fdamp</code> parameter is also slightly different from Turbospectrum&#39;s.  See the documentation of the <code>vdW</code> parameter of <a href="#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Line</code></a> for details.  Korg will error if   encounters an Unsoeld fudge factor, which it does not support.</li><li>&quot;turbospectrum_vac&quot; for a Turbospectrum linelist in vacuum wavelengths.</li></ul><p>For VALD and Turbospectrum linelists with isotope information available, Korg will scale log gf  values by isotopic abundance (unless VALD has already pre-scaled them), using isotopic abundances from <a href="https://www.nist.gov/pml/atomic-weights-and-isotopic-compositions-relative-atomic-masses">NIST</a>  ([Korg.isotopic<em>abundances]). To use custom isotopic abundances, just pass `isotopic</em>abundances` with the same structure:  a dict mapping atomic number to a dict mapping from atomic weight to abundance.</p><p>Be warned that for linelists which are pre-scaled for isotopic abundance, the estimation of  radiative broadening from log(gf) is not accurate.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/linelist.jl#L135-L170">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.read_model_atmosphere" href="#Korg.read_model_atmosphere"><code>Korg.read_model_atmosphere</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_model_atmosphere(filename)</code></pre><p>Parse the provided model atmosphere file in MARCS &quot;.mod&quot; format.  Returns either a  <code>PlanarAtmosphere</code> or a <code>ShellAtmosphere</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/atmosphere.jl#L94-L99">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.interpolate_marcs" href="#Korg.interpolate_marcs"><code>Korg.interpolate_marcs</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">interpolate_marcs(Teff, logg, Fe_M=0, alpha_M=0, C_M=0; kwargs...)
interpolate_marcs(Teff, logg, A_X; kwargs...)</code></pre><p>Returns a model atmosphere obtained by interpolating the MARCS SDSS atmosphere grid, which provides  atmospheres for varying values of <span>$T_\mathrm{eff}$</span>, `<code>\log g</code>, [metals/H], [alpha/metals],  and [C/metals].  If the <code>A_X</code> (a vector of abundances in the format returned by <a href="../API/#Korg.format_A_X"><code>format_A_X</code></a> and accepted by <a href="../API/#Korg.synthesize"><code>synthesize</code></a>) is provided instead of <code>M_H</code>, <code>alpha_M</code>, and <code>C_M</code>, the  solar-relative ratios will be reconstructed assuming Grevesse+ 2007 solar abundances.</p><p>The model atmosphere grid is a repacked version of the  <a href="https://dr17.sdss.org/sas/dr17/apogee/spectro/speclib/atmos/marcs/MARCS_v3_2016/Readme_MARCS_v3_2016.txt">MARCS SDSS grid</a>. Before you use <code>interpolate_marcs</code> for the first time, you will have to download the grid with by  running <code>download_atmosphere_archive()</code>.  By default, the archive is stored at  <code>.korg/SDSS_MARCS_atmospheres.h5</code>.  This location can be set with the <code>KORG_DATA_DIR</code> environment  variable.</p><p><strong>keyword arguments</strong></p><ul><li><code>spherical</code>: whether or not to return a ShellAtmosphere (as opposed to a PlanarAtmosphere).  By  default true when <code>logg</code> &lt; 3.5.</li><li><code>archive</code>: The atmosphere archive to use.  This is used to override the default grid for testing.</li><li><code>solar_abundances</code>: (default: <code>grevesse_2007_solar_abundances</code>) The solar abundances to use when  <code>A_X</code> is provided instead of <code>M_H</code>, <code>alpha_M</code>, and <code>C_M</code>. The default is chosen to match that of  the atmosphere grid, and is probably no good reason to change it.</li><li><code>clamp_abundances</code>: (default: <code>false</code>) allowed when specifying <code>A_X</code> direction. Whether or not to   clamp the abundance paramerters to be within the range of the MARCS grid to avoid throwing an out   of bounds error. Use with caution.</li><li><code>perturb_at_grid_values</code>: when true this will add or a subtract a very small number to each   parameter which is exactly at a grid value. This prevents null derivatives, which can cause   problems for minimizers.  </li></ul><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Atmosphere interpolation contributes non-negligeble error to synthesized spectra below  Teff ≈ 4250 K. We do not endorse using it for science in that regime. See  https://github.com/ajwheeler/Korg.jl/issues/164 for a discussion of the issue.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/atmosphere.jl#L240-L275">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.format_A_X" href="#Korg.format_A_X"><code>Korg.format_A_X</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">format_A_X(default_metals_H, default_alpha_H, abundances; kwargs... )</code></pre><p>Returns a 92 element vector containing abundances in <span>$A(X)$</span> (<span>$\log_{10}(X/H) + 12$</span>) format for elements from hydrogen to uranium.</p><p><strong>Arguments</strong></p><p>You can specify abundance with these positional arguments.  All are optional, but if  <code>default_alpha_H</code> is provided, <code>default_metals_H</code> must be as well. </p><ul><li><code>default_metals_H</code> (default: 0), i.e. [metals/H] is the <span>$\log_{10}$</span> solar-relative abundance of elements heavier   than He. It is overriden by <code>default_alpha</code> and <code>abundances</code> on a per-element basis.  </li><li><code>default_alpha_H</code> (default: same as <code>default_metals_H</code>), i.e. [alpha/H] is the <span>$\log_{10}$</span>   solar-relative abundance of the alpha elements (defined to be C, O, Ne, Mg, Si, S, Ar, Ca, and   Ti). It is overriden by <code>abundances</code> on a per-element basis.</li><li><code>abundances</code> is a <code>Dict</code> mapping atomic numbers or symbols to [<span>$X$</span>/H] abundances.  (Set  <code>solar_relative=false</code> to use <span>$A(X)$</span> abundances instead.) These override <code>default_metals_H</code>. This is the only way to specify an abundance of He that is non-solar.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>solar_relative</code> (default: true): When true, interpret abundances as being in [<span>$X$</span>/H]  (<span>$\log_{10}$</span> solar-relative) format.  When false, interpret them as <span>$A(X)$</span> abundances, i.e.   <span>$A(x) = \log_{10}(n_X/n_\mathrm{H}) + 12$</span>, where <span>$n_X$</span> is the number density of <span>$X$</span>.  Note that abundances not specified default to the solar value still depend on the solar value, as  they are set according to <code>default_metals_H</code> and <code>default_alpha_H</code>.</li><li><code>solar_abundances</code> (default: <code>Korg.asplund_2020_solar_abundances</code>) is the set of solar abundances to  use, as a vector indexed by atomic number. <code>Korg.asplund_2009_solar_abundances</code> and  <code>Korg.grevesse_2007_solar_abundances</code> are also provided for convienience.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/synthesize.jl#L240-L267">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.Fit.find_best_fit_params" href="#Korg.Fit.find_best_fit_params"><code>Korg.Fit.find_best_fit_params</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">find_best_fit_params(obs_wls, obs_flux, obs_err, linelist, initial_guesses, fixed_params; kwargs...)</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This is in beta. It&#39;s API may change.  Use at your own risk.</p></div></div><p>Find the parameters and abundances that best match a rectified observed spectrum.</p><p><strong>Arguments:</strong></p><ul><li><code>obs_wls</code>: the wavelengths of the observed spectrum in Å</li><li><code>obs_flux</code>: the rectified flux of the observed spectrum</li><li><code>obs_err</code>: uncertainty in <code>flux</code></li><li><code>linelist</code>: a linelist to use for the synthesis</li><li><code>initial_guesses</code>: a NamedTuple specifying initial guesses for the parameters to be fit.  See  &quot;Specifying parameters&quot; below.</li><li><code>fixed_params</code>: a NamedTuple specifying parameters to be held fixed. See &quot;Specifying parameters&quot;  below.</li></ul><p><strong>Specifying parameters</strong></p><p>Parameters are specified as NamedTuples, which look like this: <code>(Teff=5000, logg=4.5, m_H=0.0)</code>. Single-element NamedTuples require a semicolon: <code>(; Teff=5000)</code>. </p><p><strong>Required parameters</strong></p><p><code>Teff</code> and <code>logg</code> <em>must</em> be specified in either <code>initial_guesses</code> or <code>fixed_params</code>.</p><p><strong>Optional Parameters</strong></p><p>These can be specified in either <code>initial_guesses</code> or <code>fixed_params</code>, but if they are not default  values are used.</p><ul><li><code>m_H</code>: the metallicity of the star, in dex. Default: <code>0.0</code></li><li><code>vmic</code>: the microturbulence velocity, in km/s. Default: <code>1.0</code></li><li><code>vsini</code>: the projected rotational velocity of the star, in km/s. Default: <code>0.0</code>.   See <a href="#Korg.apply_rotation-Union{Tuple{R}, Tuple{Any, R, Any}, Tuple{Any, R, Any, Any}} where R&lt;:AbstractRange"><code>Korg.apply_rotation</code></a> for details.</li><li><code>epsilon</code>: the linear limb-darkening coefficient. Default: <code>0.6</code>. Used for applying rotational  broadening only.  See <a href="#Korg.apply_rotation-Union{Tuple{R}, Tuple{Any, R, Any}, Tuple{Any, R, Any, Any}} where R&lt;:AbstractRange"><code>Korg.apply_rotation</code></a> for details.</li><li>Individual elements, e.g. <code>Na</code>, specify the solar-relative ([X/H]) abundance of that element. </li></ul><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>If you are doing more than a few fits, you will save a lot of time by precomputing the LSF  matrix and synthesis wavelengths.  See the keyword arguments below for how to do that.</p></div></div><p><strong>Keyword arguments</strong></p><ul><li><code>windows</code> (optional) is a vector of wavelength pairs, each of which specifies a wavelength  &quot;window&quot; to synthesize and contribute to the total χ². If not specified, the entire spectrum is  used. Overlapping windows are automatically merged.</li><li><code>LSF_matrix</code> (optional) is a matrix which maps the synthesized spectrum to the observed spectrum.  If not specified, it is calculated using <code>Korg.compute_LSF_matrix</code>.  Computing the LSF matrix can  be expensive, so you may want to precompute it if you are fitting many spectra with the same LSF.</li><li><code>synthesis_wls</code>: a superset of the wavelengths to synthesize, as a range.  If not specified,   wavelengths spanning the first and last windows are used. If you pass in a precomputed   LSF matrix, you must make sure that the synthesis wavelengths match it.</li><li><code>wl_buffer</code> is the number of Å to add to each side of the synthesis range for each window.</li><li><code>precision</code> specifies the tolerance for the solver to accept a solution. The solver operates on   transformed parameters, so <code>precision</code> doesn&#39;t translate straitforwardly to Teff, logg, etc, but   the default is, <code>1e-3</code>, provides a worst-case tolerance of about 1.5K in <code>Teff</code>, 0.002 in <code>logg</code>,   0.001 in <code>m_H</code>, and 0.004 in detailed abundances.</li></ul><p><strong>Returns</strong></p><p>A NamedTuple with the following fields:</p><ul><li><code>best_fit_params</code>: the best-fit parameters</li><li><code>best_fit_flux</code>: the best-fit flux, with LSF applied, resampled, and rectified.  </li><li><code>obs_wl_mask</code>: a bitmask for <code>obs_wls</code> which selects the wavelengths used in the fit (i.e. those  in the <code>windows</code>)</li><li><code>solver_result</code>: the result object from <code>Optim.jl</code></li><li><code>trace</code>: a vector of NamedTuples, each of which contains the parameters at each step of the  optimization.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/fit.jl#L133-L198">source</a></section></article><h1 id="Secondary-functions"><a class="docs-heading-anchor" href="#Secondary-functions">Secondary functions</a><a id="Secondary-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Secondary-functions" title="Permalink"></a></h1><p>You don&#39;t need use these to synthesize spectra, but they might be relevant depending on what you are  doing.</p><h2 id="Postprocessing"><a class="docs-heading-anchor" href="#Postprocessing">Postprocessing</a><a id="Postprocessing-1"></a><a class="docs-heading-anchor-permalink" href="#Postprocessing" title="Permalink"></a></h2><p>These are used to transform observational or synthetic spectra.</p><article class="docstring"><header><a class="docstring-binding" id="Korg.rectify" href="#Korg.rectify"><code>Korg.rectify</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">rectify(flux, wls; bandwidth=50, q=0.95, wl_step=1.0)</code></pre><p>Rectify the spectrum with flux vector <code>flux</code> and wavelengths <code>wls</code> by dividing out a moving <code>q</code>-quantile with window size <code>bandwidth</code>.  <code>wl_step</code> controls the size of the grid that the moving  quantile is calculated on and interpolated from.  Setting <code>wl_step</code> to 0 results in the exact  calculation with no interpolation, but note that this is very slow when the <code>wls</code> is sampled for  synthesis (~0.01 Å).</p><p>Experiments on real spectra show an agreement between the interpolated rectified spectrum and the  &quot;exact&quot; one (with default values) at the 3 × 10^-4 level.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This function should not be applied to data with observational error, as taking a quantile will bias the rectification relative to the noiseless case.  It is intended as a fast way to compute nice-looking rectified theoretical spectra.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/utils.jl#L206-L222">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.constant_R_LSF" href="#Korg.constant_R_LSF"><code>Korg.constant_R_LSF</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">constant_R_LSF(flux, wls, R; window_size=4)</code></pre><p>Applies a gaussian line spread function the the spectrum with flux vector <code>flux</code> and wavelength vector <code>wls</code> with constant spectral resolution, <span>$R = \lambda/\Delta\lambda$</span>, where  <span>$\Delta\lambda$</span> is the LSF FWHM.  The <code>window_size</code> argument specifies how far out to extend the convolution kernel in standard deviations.</p><p>For the best match to data, your wavelength range should extend a couple <span>$\Delta\lambda$</span> outside  the region you are going to compare.</p><p>If you are convolving many spectra defined on the same wavelenths to observational resolution, you  will get much better performance using <a href="#Korg.compute_LSF_matrix-Tuple{Any, Any, Any}"><code>compute_LSF_matrix</code></a>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><ul><li><p>This is a naive, slow implementation.  Do not use it when performance matters.</p></li><li><p><code>constant_R_LSF</code> will have weird behavior if your wavelength grid is not locally linearly-spaced.  It is intended to be run on a fine wavelength grid, then downsampled to the observational (or   otherwise desired) grid.</p></li></ul></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/utils.jl#L67-L87">source</a></section></article><h2 id="Line-absorption"><a class="docs-heading-anchor" href="#Line-absorption">Line absorption</a><a id="Line-absorption-1"></a><a class="docs-heading-anchor-permalink" href="#Line-absorption" title="Permalink"></a></h2><p>These functions can be used to directly compute line opacities. </p><article class="docstring"><header><a class="docstring-binding" id="Korg.line_absorption!" href="#Korg.line_absorption!"><code>Korg.line_absorption!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">line_absorption(linelist, λs, temp, nₑ, n_densities, partition_fns, ξ
               ; α_cntm=nothing, cutoff_threshold=1e-3, window_size=20.0*1e-8)</code></pre><p>Calculate the opacity coefficient, α, in units of cm^-1 from all lines in <code>linelist</code>, at wavelengths <code>λs</code> [cm^-1]. </p><p>other arguments:</p><ul><li><code>temp</code> the temerature in K (as a vector, for multiple layers, if you like)</li><li><code>n_densities</code>, a Dict mapping species to absolute number density in cm^-3 (as a vector, if temp is  a vector).</li><li><code>partition_fns</code>, a Dict containing the partition function of each species</li><li><code>ξ</code> is the microturbulent velocity in cm/s (n.b. NOT km/s)</li><li><code>α_cntm</code> is as a callable returning the continuum opacity as a function of wavelength. The window   within which a line is calculated will extend to the wavelength at which the Lorentz wings or   Doppler core of the line are at <code>cutoff_threshold * α_cntm[line.wl]</code>, whichever is greater.  </li><li><code>cuttoff_threshold</code> (optional, default: 1e-3): see <code>α_cntm</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/line_absorption.jl#L5-L22">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.line_profile" href="#Korg.line_profile"><code>Korg.line_profile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">line_profile(λ₀, σ, γ, amplitude, λ)</code></pre><p>A voigt profile centered on λ₀ with Doppler width σ (NOT √[2] σ, as the &quot;Doppler width&quot; is often  defined) and Lorentz HWHM γ evaluated at <code>λ</code> (cm).  Returns values in units of cm^-1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/line_absorption.jl#L611-L616">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.hydrogen_line_absorption!" href="#Korg.hydrogen_line_absorption!"><code>Korg.hydrogen_line_absorption!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">hydrogen_line_absorption!(αs, λs, T, nₑ, nH_I, UH_I, ξ, window_size; kwargs...)</code></pre><p>Calculate contribution to the the absorption coefficient, αs, from hydrogen lines in units of cm^-1, at wavelengths <code>λs</code> (a vector of ranges).</p><p>Uses profiles from <a href="https://ui.adsabs.harvard.edu/abs/1999A%26AS..140...93S/abstract">Stehlé &amp; Hutcheon (1999)</a>, which include Stark and Doppler broadening.   For Halpha, Hbeta, and Hgamma, the p-d approximated profiles from  <a href="https://ui.adsabs.harvard.edu/abs/2000A%26A...363.1091B/abstract">Barklem, Piskunovet, and O&#39;Mara 2000</a> are added to the absortion coefficient.  This &quot;convolution by summation&quot; is inexact, but true  convolution is expensive.</p><p>Arguments:</p><ul><li><code>T</code>: temperature [K]</li><li><code>nₑ</code>: electron number density [cm^-3]</li><li><code>nH_I</code>: neutral hydrogen number density [cm^-3]</li><li><code>UH_I</code>: the value of the neutral hydrogen partition function</li><li><code>ξ</code>: microturbulent velocity [cm/s]. This is only applied to Hα-Hγ.  Other hydrogen lines profiles   are dominated by stark broadening, and the stark broadened profiles are pre-convolved with a   doppler profile.</li><li><code>window_size</code>: the max distance from each line center [cm] at which to calculate the stark  and self broadening profiles  absorption for Hα-Hγ (those dominated by self-broadening).</li></ul><p>Keyword arguments:</p><ul><li><code>stark_profiles</code> (default: <code>Korg._hline_stark_profiles</code>): tables from which to interpolate Stark   profiles</li><li><code>use_MHD</code>: whether or not to use the Mihalas-Daeppen-Hummer formalism to adjust the occupation   probabilities of each hydrogen orbital for plasma effects.  Default: <code>true</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/line_absorption.jl#L152-L182">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.voigt_hjerting" href="#Korg.voigt_hjerting"><code>Korg.voigt_hjerting</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">voigt_hjerting(α, v)</code></pre><p>The <a href="https://en.wikipedia.org/wiki/Voigt_profile#Voigt_functions">Hjerting function</a>, <span>$H$</span>,  somtimes called the Voigt-Hjerting function. <span>$H$</span> is defined as <code>H(α, v) = ∫^∞_∞ exp(-y^2) / ((u-y)^2 + α^2) dy</code> (see e.g. the unnumbered equation after Gray equation 11.47).  It is equal to the ratio of the  absorption coefficient to the value of the absorption coefficient obtained at the line center with  only Doppler broadening.</p><p>If <code>x = λ-λ₀</code>, <code>Δλ_D = σ√2</code> is the Doppler width, and <code>Δλ_L = 4πγ</code> is the Lorentz width,</p><pre><code class="nohighlight hljs">voigt(x|Δλ_D, Δλ_L) = H(Δλ_L/(4πΔλ_D), x/Δλ_D) / (Δλ_D√π)
                    = H(γ/(σ√2), x/(σ√2)) / (σ√(2π))</code></pre><p>Approximation from <a href="https://ui.adsabs.harvard.edu/abs/1956ZA.....39...36H/abstract">Hunger 1965</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/line_absorption.jl#L638-L654">source</a></section></article><h2 id="Continuum-absorption"><a class="docs-heading-anchor" href="#Continuum-absorption">Continuum absorption</a><a id="Continuum-absorption-1"></a><a class="docs-heading-anchor-permalink" href="#Continuum-absorption" title="Permalink"></a></h2><p>These function can be used to directly compute continuum absorption coefficients.</p><h5 id="Continuum-Absorption-Kwargs"><a class="docs-heading-anchor" href="#Continuum-Absorption-Kwargs">Continuum Absorption Kwargs</a><a id="Continuum-Absorption-Kwargs-1"></a><a class="docs-heading-anchor-permalink" href="#Continuum-Absorption-Kwargs" title="Permalink"></a></h5><p>All bound-free and free-free absorption functions (other than <code>absorption_coef_bf_TOPBase</code>) support the following keyword arguments:</p><ul><li><code>error_oobounds::Bool</code>: specifies the function&#39;s behavior when it encounters invalid <code>ν</code> or <code>T</code> values. When <code>false</code> (the default), the function assumes that the absorption coefficient for these invalid <code>ν</code> or <code>T</code> values is <code>0.0</code>. Otherwise, a <code>DomainError</code> is thrown when invalid <code>ν</code> or <code>T</code> values are encountered.</li><li><code>out_α::Union{Nothing,AbstractVector}</code>: When this is <code>nothing</code> (the default case), the function will simply allocate a new vector to store the output continuum absorption coefficients. Alternatively, this can be a vector (with the same length as the function&#39;s <code>ν</code> argument). In this case, the function will directly add the computed continuum absorption to the elements of this vector, in-place (the vector is also returned by the function).</li></ul><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.total_continuum_absorption" href="#Korg.ContinuumAbsorption.total_continuum_absorption"><code>Korg.ContinuumAbsorption.total_continuum_absorption</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">total_continuum_absorption(νs, T, nₑ, number_densities, partition_funcs; error_oobounds)</code></pre><p>The total continuum linear absoprtion coefficient, α, at many frequencies, ν.</p><p><strong>Arguments</strong></p><ul><li><code>νs</code> are frequencies in Hz</li><li><code>T</code> is temperature in K</li><li><code>nₑ</code> is the electron number density in cm^-3</li><li><code>number_densities</code> is a <code>Dict</code> mapping each <code>Species</code> to its number density</li><li><code>partition_funcs</code> is a <code>Dict</code> mapping each <code>Species</code> to its partition function (e.g. <code>Korg.partition_funcs</code>)</li><li><code>error_oobounds::Bool</code> specifies the behavior of most continnum absorption sources when passed  frequencies or temperature values that are out of bounds for their implementation. When <code>false</code>  (the default), those absorption sources are ignored at those values. Otherwise, an error is  thrown.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>For efficiency reasons, <code>νs</code> must be sorted. While this function technically supports any  sorted <code>AbstractVector</code>, it is most effient when passed an  <code>AbstractRange</code>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/ContinuumAbsorption.jl#L16-L37">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.H_I_bf" href="#Korg.ContinuumAbsorption.H_I_bf"><code>Korg.ContinuumAbsorption.H_I_bf</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">H_I_bf(νs, T, nH, nHe, ne, invU_H; n_max_MHD=6, use_hubeny_generalization=false, 
       taper=false, use_MHD_for_Lyman=false)</code></pre><p>The bound-free linear absorption coefficient contributed by all energy states of a neutral Hydrogen  atom. Even though the Mihalas-Hummer-Daeppen (MHD) occupation probability formalism is not used in Korg when computing the hydrogen partition function, it is used here. That means that series limit jumps (e.g. the Balmer jump), are &quot;rounded off&quot;, as photons with less than the &quot;classical&quot;  ionization energy can ionize if the upper level is dissolved into the continuum.</p><p><strong>Required Arguments</strong></p><ul><li><code>νs</code>: sorted frequency vector in Hz</li><li><code>T</code>: temperature in K</li><li><code>nH_I</code>: the total number density of neutral Hydrogen (in cm⁻³)</li><li><code>nHe_I</code>: the total number density of neutral Helium (in cm⁻³)</li><li><code>ne</code>: the number density of electrons (in cm⁻³)</li><li><code>invU_H</code>: The inverse of the neutral hydrogen partition function (neglecting contributions from the MHD formalism)</li></ul><p>For n=1 through n=<code>n_max_MHD</code> (default: 6), the cross-sections are computed using  <a href="https://ui.adsabs.harvard.edu/abs/2021Atoms...9...73N/abstract">Nahar 2021</a>.  These are modified using the MHD formalism to account for level dissolution.   For larger n, the cross-sections are calculated with a simple analytic formula (see  <a href="#Korg.ContinuumAbsorption.simple_hydrogen_bf_cross_section-Tuple{Integer, Real}"><code>simple_hydrogen_bf_cross_section</code></a>).</p><p>Because MHD level dissolution applied to the the Lyman series limit leads to inflated cross-sections in the visible, we don&#39;t use MHD for bf absorption from n=1.  This can be overridden by setting <code>use_MHD_for_Lyman=true</code>, in which case you will also want to set <code>taper=true</code>, which the same  tapering of the cross-section as <a href="https://github.com/barklem/hlinop/blob/master/hbop.f">HBOP</a> to fix  the problem.</p><p>The <code>use_hubeny_generalization</code> keyword argument enables the generalization of the MHD from  Hubeny 1994. It is experimental and switched off by default.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/absorption_H.jl#L22-L55">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.Hminus_bf" href="#Korg.ContinuumAbsorption.Hminus_bf"><code>Korg.ContinuumAbsorption.Hminus_bf</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Hminus_bf(ν, T, nH_I_div_partition, ne; kwargs...)</code></pre><p>Compute the H⁻ bound-free linear absorption coefficient α, <span>$\alpha_\nu = \sigma_{bf}(H^-) n(H⁻) (1 - \exp \left( \frac{-h\nu}{k T}\right))$</span></p><p><strong>Arguments</strong></p><ul><li><code>ν::AbstractVector{&lt;:Real}</code>: sorted frequency vector in Hz</li><li><code>T</code>: temperature in K</li><li><code>nH_I_div_partition</code>: the total number density of H I divided by its partition function.</li><li><code>ne</code>: the electron number density</li></ul><p>This uses cross-sections from  <a href="https://ui.adsabs.harvard.edu/abs/2017JPhB...50k4001M/abstract">McLaughlin 2017</a>. For a description of the kwargs, see <a href="#Continuum-Absorption-Kwargs">Continuum Absorption Kwargs</a>.</p><p><strong>Notes</strong></p><p>This function assumes that n(H⁻) ≪ n(H I) + n(H II). The number density of n(H⁻) isn&#39;t precomputed  as part of Korg&#39;s molecular equlibrium, it&#39;s computed here instead.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The McLaughlin tabulated values (downloaded as a text file) contained a stray line out of  monotonic order.  A version of the data file with the line deleted is saved at  <code>data/McLaughlin2017Hminusbf.dat</code> for archival purposes.  (Korg doesn&#39;t read this file, it reads <code>data/McLaughlin2017Hminusbf.h5</code>.)</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/absorption_H.jl#L232-L258">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.Hminus_ff" href="#Korg.ContinuumAbsorption.Hminus_ff"><code>Korg.ContinuumAbsorption.Hminus_ff</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Hminus_ff(ν, T, nH_I_div_partition, ne; kwargs...)</code></pre><p>Compute the H⁻ free-free linear absorption coefficient α</p><p>The naming scheme for free-free absorption is counter-inutitive. This actually refers to the reaction:  photon + e⁻ + H I -&gt; e⁻ + H I.</p><p><strong>Arguments</strong></p><ul><li><code>ν::AbstractVector{&lt;:Real}</code>: sorted frequency vector in Hz</li><li><code>T</code>: temperature in K</li><li><code>nH_I_div_partition::Flt</code>: the total number density of H I divided by its partition function.</li><li><code>ne</code>: the number density of free electrons.</li></ul><p>For a description of the kwargs, see <a href="#Continuum-Absorption-Kwargs">Continuum Absorption Kwargs</a>.</p><p><strong>Notes</strong></p><p>This is based on Table 1, in  <a href="https://doi.org/10.1088/0022-3700/20/4/019">Bell &amp; Berrington (1987)</a>, which tabulates values for &quot;the H⁻ absorption coefficient&quot;, K (including the correction for stimulated emission). This  quantity is in units of cm^4/dyn, and must be multiplied by the electron partial pressure and the  ground-state neutral hydrogen number density to obtain a linear absorption coefficent, α.</p><p>The stipulation that the hydrogen should be ground-state only is based on the beginning of Section 2 in Bell and Berrington (1987), or alternately, Section 5.3 from Kurucz (1970).  When Gray (2005) refers to this, it implicitly assumes that <code>n(H I, n = 1) ≈ n(H I)</code>.  Note that  <code>n(H I, n = 1) = n(H I)*gₙ₌₁/U(T)*exp(-Eₙ₌₁/(k*T)) = n(H I) * 2/U(T)*exp(0) = n(H I) * 2/U(T).</code> Since U(T) ≈ 2 up to fairly large temperatures, this is not unreasonable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/absorption_H.jl#L320-L350">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.H2plus_bf_and_ff" href="#Korg.ContinuumAbsorption.H2plus_bf_and_ff"><code>Korg.ContinuumAbsorption.H2plus_bf_and_ff</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">H2plus_bf_and_ff(ν, T, nH_I_div_partition, n_HII; kwargs...)</code></pre><p>Compute the combined H₂⁺ bound-free and free-free linear absorption coefficient α using the tables  from <a href="https://ui.adsabs.harvard.edu/abs/1994ApJ...430..360S/abstract">Stancil 1994</a>. Note that  this refers to interactions between free-protons and neutral hydrogen, not electrons and doubly  ionized H2, i.e. the b-f interaction is photodissociation, not photoionization.</p><p><strong>Arguments</strong></p><ul><li><code>ν::AbstractVector{&lt;:Real}</code>: sorted frequency vector in Hz</li><li><code>T</code>: temperature in K</li><li><code>nH_I</code>: the total number density of H I divided by its partition   function.</li><li><code>nH_II</code>: the number density of H II (not of H₂⁺).</li></ul><p>For a description of the kwargs, see <a href="#Continuum-Absorption-Kwargs">Continuum Absorption Kwargs</a>.</p><p><strong>Notes</strong></p><p>This computes the H₂⁺ number density from those of H I and H II, since ionized molecules  are not included in the molecular equlibrium calculation.  Stancil provides approximate equilibrium  constants, K, for the molecule, but the Barklem and Collet values used elsewhere by Korg may be more  reliable.  Once ionized molecules are fully supported, those values should be used instead. While  cross sections are tabulated down to only 3150 K, the cross sections could be linearly interpolated  1000 K or so lower, if reliable K values are availble.</p><p>Because n(H₂⁺) is computed on the fly, the &quot;cross-sections&quot; used (internally) by this function have units of  cm^-5, since they must be multiplied by n(H I) and n(H II) to obtain absorption coefficients.</p><p>Stancil, <a href="https://ui.adsabs.harvard.edu/abs/1952MNRAS.112...40B/abstract">Bates (1952)</a>, and Gray (2005) all use n(H I), but Kurucz (1970) notes in section 5.2 that the photodisociation of H₂⁺  produces a ground state H atom and that we should therefore use n(H I, n=1) instead. This difference  causes a descrepancy of a fraction of a percent (at most) for T ≤ 1.2e4 K. Here we use n(H I).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/absorption_H.jl#L368-L400">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.Heminus_ff" href="#Korg.ContinuumAbsorption.Heminus_ff"><code>Korg.ContinuumAbsorption.Heminus_ff</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Heminus_ff(ν, T, nHe_I_div_partition, ne; kwargs...)</code></pre><p>Compute the He⁻ free-free opacity κ.</p><p>The naming scheme for free-free absorption is counter-inutitive. This actually refers to the reaction:  <code>photon + e⁻ + He I -&gt; e⁻ + He I.</code></p><p><strong>Arguments</strong></p><ul><li><code>ν::AbstractVector{&lt;:Real}</code>: sorted frequency vector in Hz</li><li><code>T</code>: temperature in K</li><li><code>nHe_I_div_partition</code>: the total number density of H I divided by its partition function.</li><li><code>ne</code>: the number density of free electrons.</li></ul><p>For a description of the kwargs, see <a href="#Continuum-Absorption-Kwargs">Continuum Absorption Kwargs</a>.</p><p><strong>Notes</strong></p><p>This uses the tabulated values from  <a href="https://ui.adsabs.harvard.edu/abs/1994MNRAS.269..871J/abstract">John (1994)</a>.  The quantity K is the same used by <a href="https://doi.org/10.1088/0022-3700/20/4/019">Bell and Berrington (1987)</a>.  See  <a href="#Korg.ContinuumAbsorption.Hminus_ff"><code>Hminus_ff</code></a> for an explanation.</p><p>According to John (1994), improved calculations are unlikely to alter the tabulated data for  λ &gt; 1e4Å, &quot;by more than about 2%.&quot; The errors introduced by the approximations for  5.06e3 Å ≤ λ ≤ 1e4 Å &quot;are expected to be well below 10%.&quot;</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/absorption_He.jl#L68-L93">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.electron_scattering" href="#Korg.ContinuumAbsorption.electron_scattering"><code>Korg.ContinuumAbsorption.electron_scattering</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">electron_scattering(nₑ)</code></pre><p>Compute the linear absorption coefficient, α, from scattering off of free electrons. This has no wavelength dependence. It assumes isotropic scattering.  (See, e.g. Gray p 160.)</p><p><strong>Arguments</strong></p><ul><li><code>nₑ::F</code>: number density of free electrons (in cgs)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/scattering.jl#L44-L52">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.rayleigh" href="#Korg.ContinuumAbsorption.rayleigh"><code>Korg.ContinuumAbsorption.rayleigh</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">rayleigh(λs, nH_I, nHe_II, nH2)</code></pre><p>Absorption coefficient from Rayleigh scattering by neutral H, He, and H2.  Formulations for H and He are via <a href="https://ui.adsabs.harvard.edu/abs/2016ApJ...817..116C/abstract">Colgan+ 2016</a>.  Formulation  for H2 from  <a href="https://ui.adsabs.harvard.edu/abs/1962ApJ...136..690D/abstract">Dalgarno and Williams 1962</a>.</p><p>The Dalgarno and Williams H2 is applicable redward of 1300 Å.  Since Rayleigh scattering breaks down when the particle size to wavelength ratio gets large, we that all frequencies passed to this  function be equivalent to 1300 Å or greater.</p><p>The formulations for H is adapted from  <a href="https://ui.adsabs.harvard.edu/abs/1962ApJ...136..690D/abstract">Lee 2005</a>, which states that it is  applicable redward of Lyman alpha. See Colgan 2016 for details on He.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/scattering.jl#L1-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.positive_ion_ff_absorption!" href="#Korg.ContinuumAbsorption.positive_ion_ff_absorption!"><code>Korg.ContinuumAbsorption.positive_ion_ff_absorption!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">positive_ion_ff_absorption!(α_out::Vector{Real}, ν::Real, T::Real, number_densities::Dict, 
                            ne::Real, departure_coefficients=Peach1970.departure_coefficients)</code></pre><p>Computes the linear absorption coefficient (in cm⁻¹) for all free-free interactions involving positively charged atomic species. Uses the provided departure coefficients when they are available, and the uncorrected hydrogenic approximation when they are not.</p><p><strong>Arguments</strong></p><ul><li><code>ν</code>: frequency in Hz</li><li><code>T</code>: temperature in K</li><li><code>number_densities</code> is a <code>Dict</code> mapping each <code>Species</code> to its number density.</li><li><code>ne</code>: the number density of free electrons.</li><li><code>departure_coefficients</code> (optional, defaults to   <code>ContinuumAbsorption.Peach1970.departure_coefficients</code>:   a dictionary mapping species to the departure coefficients for the ff process it participates in   (e.g. <code>species&quot;C II&quot;</code> maps to the C III ff departure coefficients–see note below).  Departure  coefficients should be callables taking temperature and (photon energy / RydbergH / Zeff^2).  </li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>A free-free interaction is named as though the species interacting with the free electron had  one more bound electron (in other words it&#39;s named as though the free-electron and ion were  bound together). To make matters more confusing, some sources present the free-free linear  absorption coefficient&#39;s formula in terms of the number density of the species in the  interaction&#39;s name (by including the Saha equation in the formula).</p><p>To compute the absorption for a given free-free interaction, this function accesses elements  from the dictionary arguments that are associated with the species that participates in the  interaction. For example:</p><ul><li>Si I ff absorption: uses the number density of Si II (<code>number_densities[species&quot;Si II&quot;]</code>) and checks <code>departure_coefficients[species&quot;Si II&quot;]</code> for departure coefficients.</li><li>Si II ff absorption: uses the number density of Si III (<code>number_densities[species&quot;Si III&quot;]</code>) and checks <code>departure_coefficients[species&quot;Si III&quot;]</code> for departure coefficients.</li></ul></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/ContinuumAbsorption/absorption_ff_positive_ion.jl#L3-L36">source</a></section></article><h2 id="Statistical-mechanics"><a class="docs-heading-anchor" href="#Statistical-mechanics">Statistical mechanics</a><a id="Statistical-mechanics-1"></a><a class="docs-heading-anchor-permalink" href="#Statistical-mechanics" title="Permalink"></a></h2><p>These functions can be used to calculate the number densities of all species in a given atmospheric  layer, or other statmech calculations. </p><article class="docstring"><header><a class="docstring-binding" id="Korg.saha_ion_weights" href="#Korg.saha_ion_weights"><code>Korg.saha_ion_weights</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">saha_ion_weights(T, nₑ, atom, ionization_energies, partition_functions)</code></pre><p>Returns <code>(wII, wIII)</code>, where <code>wII</code> is the ratio of singly ionized to neutral atoms of a given  element, and <code>wIII</code> is the ration of doubly ionized to neutral atoms.</p><p>arguments:</p><ul><li>temperature <code>T</code> [K]</li><li>electron number density <code>nₑ</code> [cm^-3]</li><li>atom, the atomic number of the element </li><li><code>ionization_energies</code> is a collection indexed by integers (e.g. a <code>Vector</code>) mappping elements&#39;   atomic numbers to their first three ionization energies</li><li><code>partition_funcs</code> is a <code>Dict</code> mapping species to their partition functions</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/statmech.jl#L3-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.chemical_equilibrium" href="#Korg.chemical_equilibrium"><code>Korg.chemical_equilibrium</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">chemical_equilibrium(T, nₜ, nₑ, absolute_abundances, ionization_energies, 
                     partition_fns, log_equilibrium_constants; x0=nothing)</code></pre><p>Iteratively solve for the number density of each species. Returns a <code>Dict</code> mapping species to number  densities.</p><p>arguments:</p><ul><li>the temperature, <code>T</code>, in K</li><li>the number density of non-electron particles <code>nₜ</code></li><li>the electron number density <code>nₑ</code></li><li>A Dict of <code>absolute_abundances</code>, N<em>X/N</em>total</li><li>a Dict of ionization energies, <code>ionization_energies</code>.  The keys of act as a list of all atoms.</li><li>a Dict of partition functions, <code>partition_fns</code></li><li>a Dict of log molecular equilibrium constants, <code>log_equilibrium_constants</code>, in partial pressure form.  The keys of <code>equilibrium_constants</code> act as a list of all molecules.</li></ul><p>keyword arguments:</p><ul><li><code>x0</code> (default: <code>nothing</code>) is an initial guess for the solution (in the format internal to  <code>chemical_equilibrium</code>). If not supplied, a good guess is computed by neglecting molecules.</li><li><code>electron_number_density_warn_threshold</code> (default: <code>0.25</code>) is the fractional difference between  the calculated electron number density and the model atmosphere electron number density at which  a warning is issued.</li></ul><p>The system of equations is specified with the number densities of the neutral atoms as free  parameters.  Each equation specifies the conservation of a particular species, e.g. (simplified)</p><pre><code class="nohighlight hljs">n(O) = n(CO) + n(OH) + n(O I) + n(O II) + n(O III).</code></pre><p>In this equation:</p><ul><li><code>n(O)</code>, the number density of oxygen atoms in any form comes <code>absolute_abundances</code> and the total</li></ul><p>number density (supplied later)</p><ul><li><code>n(O I)</code> is a free parameter.  The numerical solver is varying this to satisfy the system of  equations.</li><li><code>n(O II)</code>, and <code>n(O III)</code> come from the Saha (ionization) equation given <code>n(O I)</code></li><li><code>n(CO)</code> and <code>n(OH)</code> come from the molecular equilibrium constants K, which are precomputed  over a range of temperatures. </li></ul><p>Equilibrium constants are defined in terms of partial pressures, so e.g.</p><pre><code class="nohighlight hljs">K(OH)  ==  (p(O) p(H)) / p(OH)  ==  (n(O) n(H)) / n(OH)) kT</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/statmech.jl#L69-L110">source</a></section></article><h2 id="Misc"><a class="docs-heading-anchor" href="#Misc">Misc</a><a id="Misc-1"></a><a class="docs-heading-anchor-permalink" href="#Misc" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Korg.blackbody" href="#Korg.blackbody"><code>Korg.blackbody</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">blackbody(T, λ)</code></pre><p>The value of the Planck blackbody function for temperature <code>T</code> at wavelength <code>λ</code> [cm].</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/synthesize.jl#L360-L364">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.air_to_vacuum" href="#Korg.air_to_vacuum"><code>Korg.air_to_vacuum</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">air_to_vacuum(λ; cgs=λ&lt;1)</code></pre><p>Convert λ from an air to vacuum.  λ is assumed to be in Å if it is ⩾ 1, in cm otherwise.  Formula  from Birch and Downs (1994) via the VALD website.</p><p>See also: <a href="../API/#Korg.vacuum_to_air"><code>vacuum_to_air</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/utils.jl#L249-L256">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.vacuum_to_air" href="#Korg.vacuum_to_air"><code>Korg.vacuum_to_air</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">vacuum_to_air(λ; cgs=λ&lt;1)</code></pre><p>convert λ from a vacuum to air.  λ is assumed to be in Å if it is ⩾ 1, in cm otherwise.  Formula  from Birch and Downs (1994) via the VALD website.</p><p>See also: <a href="../API/#Korg.air_to_vacuum"><code>air_to_vacuum</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/b4d29bf7afbf1d747f07c18801a6fcf48c67224d/src/utils.jl#L269-L276">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../install/">« Install</a><a class="docs-footer-nextpage" href="../FAQ/">FAQ »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 3 August 2023 21:25">Thursday 3 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
