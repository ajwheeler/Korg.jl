<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Public Functions · Korg</title><meta name="title" content="Public Functions · Korg"/><meta property="og:title" content="Public Functions · Korg"/><meta property="twitter:title" content="Public Functions · Korg"/><meta name="description" content="Documentation for Korg."/><meta property="og:description" content="Documentation for Korg."/><meta property="twitter:description" content="Documentation for Korg."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Korg logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Korg</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Quickstart</a></li><li><a class="tocitem" href="../install/">Install</a></li><li><a class="tocitem" href="../tutorials/">Tutorials</a></li><li class="is-active"><a class="tocitem" href>Public Functions</a><ul class="internal"><li><a class="tocitem" href="#Built-in-linelists"><span>Built-in linelists</span></a></li><li class="toplevel"><a class="tocitem" href="#Fitting"><span>Fitting</span></a></li><li class="toplevel"><a class="tocitem" href="#Secondary-functions"><span>Secondary functions</span></a></li><li><a class="tocitem" href="#Postprocessing"><span>Postprocessing</span></a></li><li><a class="tocitem" href="#Misc"><span>Misc</span></a></li></ul></li><li><a class="tocitem" href="../FAQ/">FAQ</a></li><li><a class="tocitem" href="../devdocs/">Developer Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Public Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Public Functions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ajwheeler/Korg.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ajwheeler/Korg.jl/blob/main/docs/src/API.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>This page documents the public, stable Korg API intended for users of the package. Starting with the version 1.0 release, the developers commit to maintaining forward compatability for all of these functions (until, at least, the next major release).</p><p>If you are interested in contributing to Korg, we provide a more complete list of functions (that includes private functions) in the <a href="../devdocs/#Developer-documentation">Developer documentation</a>.</p><h1 id="API"><a class="docs-heading-anchor" href="#API">Top-level functions</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><p>If you are trying to synthesize a spectrum with Korg, these are the functions you will call. These functions are exported, so if you do <code>using Korg</code>, you can call them unqualified (i.e. <code>synthesize</code> instead of <code>Korg.synthesize</code>).</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.synth" href="#Korg.synth"><code>Korg.synth</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">synth(kwargs...)</code></pre><p>This function creates a synthetic spectrum. It&#39;s easier to use than <a href="#Korg.synthesize"><code>synthesize</code></a>, but it gives you less control. Unlike <a href="#Korg.synthesize"><code>synthesize</code></a>, it <strong>returns a tuple of <code>(wavelengths, rectified_flux, cntm)</code></strong> (Wavelength in Å, rectified flux as a unitless number between 0 and 1, and continuum in erg/s/cm^5).  <code>Korg.synth</code> also provides shortcuts for some ways you might want to post-process the spectrum (applying a LSF, rotation, etc).</p><p><strong>Keyword arguments</strong></p><ul><li><code>Teff</code>: effective temperature in K (default: 5000)</li><li><code>logg</code>: surface gravity in cgs units (default: 4.5)</li><li><code>m_H</code>: metallicity, [metals/H], (default: 0.0) (See <a href="#Korg.format_A_X"><code>format_A_X</code></a> for precisely how this is interpreted.)</li><li><code>alpha_H</code>: alpha enhancement, [α/H], (default: <code>m_H</code>) (See <a href="#Korg.format_A_X"><code>format_A_X</code></a> for precisely how this is interpreted.)</li><li><em>Any atomic symbol</em> (e.g. <code>Fe</code> or <code>C</code>) can be used to to specify a (solar relative, [<em>X</em>/H]) abundance. These override <code>m_H</code> and <code>alpha_H</code>. Specifying an individual abundance means that the true metallicity and alpha will not correspond precisely to the values of <code>m_H</code> and <code>alpha_H</code>. See <a href="#Korg.format_A_X"><code>format_A_X</code></a> for details.</li><li><code>linelist</code>: a linelist, (default: <a href="../devdocs/#Korg.get_VALD_solar_linelist-Tuple{}"><code>get_VALD_solar_linelist()</code></a>). See also <a href="#Korg.read_linelist"><code>read_linelist</code></a>.</li><li><code>wavelengths</code>: a tuple of the start and end wavelengths (default: (5000, 6000)), or a vector of <code>(λstart, λstop)</code> pairs. See <a href="../devdocs/#Korg.Wavelengths"><code>Wavelengths</code></a> for all the ways the wavelengths can be specified.</li><li><code>rectify</code>: whether to rectify (continuum normalize) the spectrum (default: true)</li><li><code>R</code>: resolution (default: <code>Inf</code>, no LSF applied). <code>R</code> can be a scalar, or a function from wavelength (in Å) to resolving power. See <a href="#Korg.apply_LSF"><code>apply_LSF</code></a> for details on how to do this manually.</li><li><code>vsini</code>: projected rotational velocity in km/s (default: 0). This calls <a href="../devdocs/#Korg.apply_rotation"><code>apply_rotation</code></a> under the hood.</li><li><code>vmic</code>: microturbulent velocity in km/s (default: 1.0).</li><li><code>synthesize_kwargs</code>: additional keyword arguments pass to <a href="#Korg.synthesize"><code>synthesize</code></a>.</li><li><code>format_A_X_kwargs</code>: additional keyword arguments pass to <a href="#Korg.format_A_X"><code>format_A_X</code></a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/synth.jl#L1-L36">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.synthesize" href="#Korg.synthesize"><code>Korg.synthesize</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">synthesize(atm, linelist, A_X, λ_start, λ_stop; kwargs... )
synthesize(atm, linelist, A_X, wavelength_ranges; kwargs... )</code></pre><p>Compute a synthetic spectrum. Returns a <a href="../devdocs/#Korg.SynthesisResult"><code>SynthesisResult</code></a>.</p><p><strong>Arguments</strong></p><ul><li><code>atm</code>: the model atmosphere (see <a href="#Korg.interpolate_marcs"><code>interpolate_marcs</code></a> and <a href="#Korg.read_model_atmosphere"><code>read_model_atmosphere</code></a>)</li><li><code>linelist</code>: A vector of <a href="../devdocs/#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Line</code></a>s (see <a href="#Korg.read_linelist"><code>read_linelist</code></a>, <a href="#Korg.get_APOGEE_DR17_linelist"><code>get_APOGEE_DR17_linelist</code></a>, <a href="#Korg.get_GES_linelist"><code>get_GES_linelist</code></a>, <a href="#Korg.get_GALAH_DR3_linelist"><code>get_GALAH_DR3_linelist</code></a>, and <a href="#Korg.get_VALD_solar_linelist"><code>get_VALD_solar_linelist</code></a>).</li><li><code>A_X</code>: a vector containing the A(X) abundances (log(X/H) + 12) for elements from hydrogen to uranium.  <a href="#Korg.format_A_X"><code>format_A_X</code></a> can be used to easily create this vector.</li><li>The wavelengths at which to synthesize the spectrum.  They can be specified either as a pair <code>(λstart, λstop)</code>, or as a list of pairs <code>[(λstart1, λstop1), (λstart2, λstop2), ...]</code> (or as an valid arugments to the <a href="../devdocs/#Korg.Wavelengths"><code>Wavelengths</code></a> constructor).</li></ul><p><strong>Example</strong></p><p>To synthesize a spectrum between 5000 Å and 5100 Å, with all metal abundances set to 0.5 dex less than the solar value except carbon, which we set to [C/H]=-0.25:</p><pre><code class="nohighlight hljs">atm = read_model_atmosphere(&quot;path/to/atmosphere.mod&quot;)
linelist = read_linelist(&quot;path/to/linelist.vald&quot;)
A_X = format_A_X(-0.5, Dict(&quot;C&quot; =&gt; -0.25))
result = synthesize(atm, linelist, A_X, 5000, 5100)</code></pre><p><strong>Optional arguments:</strong></p><ul><li><code>vmic</code> (default: 0) is the microturbulent velocity, <span>$\xi$</span>, in km/s.  This can be either a scalar value or a vector of values, one for each atmospheric layer.</li><li><code>line_buffer</code> (default: 10): the farthest (in Å) any line can be from the provided wavelength range before it is discarded.  If the edge of your window is near a strong line, you may have to turn this up.</li><li><code>cntm_step</code> (default 1): the distance (in Å) between point at which the continuum opacity is calculated.</li><li><code>hydrogen_lines</code> (default: <code>true</code>): whether or not to include H lines in the synthesis.</li><li><code>use_MHD_for_hydrogen_lines</code> (default: <code>true</code>): whether or not to use the MHD occupation probability formalism for hydrogen lines. (MHD is always used for hydrogen bound-free absorption.)</li><li><code>hydrogen_line_window_size</code> (default: 150): the maximum distance (in Å) from each hydrogen line center at which to calculate its contribution to the total absorption coefficient.</li><li><code>mu_values</code> (default: 20): the number of μ values at which to calculate the surface flux, or a vector of the specific values to use when doing transfer in spherical geometry. If <code>mu_points</code> is an integer, the values are chosen per Gauss-Legendre integration. If they are specified directly, the trapezoid rule is used for the astrophysical flux. The default values is sufficient for accuracy at the 10^-3 level. Note that if you are using the default radiative transfer scheme, with a plane-parallel model atmosphere, the integral over μ is exact, so this parameter has no effect. The points and weights are returned in the <code>mu_grid</code> field of the output.</li><li><code>line_cutoff_threshold</code> (default: <code>3e-4</code>): the fraction of the continuum absorption coefficient at which line profiles are truncated.  This has major performance impacts, since line absorption calculations dominate more syntheses.  Turn it down for more precision at the expense of runtime. The default value should effect final spectra below the 10^-3 level.</li><li><code>electron_number_density_warn_threshold</code> (default: <code>Inf</code>): if the relative difference between the calculated electron number density and the input electron number density is greater than this value, a warning is printed.  By default, this warning is suppress (threshold is <code>Inf</code>) because it is very easily raised in cases where it is of no observable consequence. See also <code>electron_number_density_warn_min_value</code>, below.</li><li><code>electron_number_density_warn_min_value</code> (default: <code>1e-4</code>): The minimum value of the ratio of the electron number density to the total number density at which a warning is printed.</li><li><code>return_cntm</code> (default: <code>true</code>): whether or not to return the continuum at each wavelength.  If this is false, <code>solution.cntm</code> will be <code>nothing</code>.</li><li><code>use_internal_reference_linelist</code> (default: <code>true</code>): whether or not to use the internal linelist for computing the opacity at the reference wavelength, which is used for radiative transfer when <code>tau_scheme</code> is &quot;anchored&quot;. If this is false, <code>linelist</code> will be used instead if it overlaps with the reference wavelength (5000 Å for MARCS model atmospheres).</li><li><code>ionization_energies</code>, a <code>Dict</code> mapping <code>Species</code> to their first three ionization energies, defaults to <code>Korg.ionization_energies</code>.</li><li><code>partition_funcs</code>, a <code>Dict</code> mapping <code>Species</code> to partition functions (in terms of ln(T)). Defaults to data from Barklem &amp; Collet 2016, <code>Korg.default_partition_funcs</code>.</li><li><code>equilibrium_constants</code>, a <code>Dict</code> mapping <code>Species</code> representing diatomic molecules to the base-10 log of their molecular equilibrium constants in partial pressure form.  Defaults to data from Barklem and Collet 2016, <code>Korg.default_log_equilibrium_constants</code>.</li><li><code>use_chemical_equilibrium_from</code> (default: <code>nothing</code>): Takes another solution returned by <code>synthesize</code>. When provided, the chemical equilibrium solution will be taken from this object, rather than being recomputed. This is physically self-consistent only when the abundances, <code>A_X</code>, and model atmosphere, <code>atm</code>, are unchanged.</li><li><code>molecular_cross_sections</code> (default: <code>[]</code>): A vector of precomputed molecular cross-sections. See <a href="../devdocs/#Korg.MolecularCrossSection-Tuple{Any, Vararg{Any}}"><code>MolecularCrossSection</code></a> for how to generate these. If you are using the default radiative transfer scheme, your molecular cross-sections should cover 5000 Å only if your linelist does.</li><li><code>tau_scheme</code> (default: &quot;linear&quot;): how to compute the optical depth.  Options are &quot;linear&quot; and &quot;bezier&quot; (testing only–not recommended).</li><li><code>I_scheme</code> (default: <code>&quot;linear_flux_only&quot;</code>): how to compute the intensity.  Options are <code>&quot;linear&quot;</code>, <code>&quot;linear_flux_only&quot;</code>, and <code>&quot;bezier&quot;</code>.  <code>&quot;linear_flux_only&quot;</code> is the fastest, but does not return the intensity values anywhere except at the top of the atmosphere.  &quot;linear&quot; performs an equivalent calculation, but stores the intensity at every layer. <code>&quot;bezier&quot;</code> is for testing and not recommended.</li><li><code>verbose</code> (default: <code>false</code>): Whether or not to print information about progress, etc.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/synthesize.jl#L42-L132">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.read_linelist" href="#Korg.read_linelist"><code>Korg.read_linelist</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_linelist(filename; format=&quot;vald&quot;, isotopic_abundances=Korg.isotopic_abundances)</code></pre><p>Parse a linelist file, returning a vector of <a href="../devdocs/#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Line</code></a>s.</p><p>The <code>format</code> keyword argument can be used to specify one of these linelist formats (default: <code>&quot;vald&quot;</code>):</p><ul><li><code>&quot;vald&quot;</code> for a <a href="http://vald.astro.uu.se/%7Evald/php/vald.php">VALD</a> linelist. These can be either &quot;short&quot; or &quot;long&quot; format, &quot;extract all&quot; or &quot;extract stellar&quot;.  Air wavelengths will automatically be converted into vacuum wavelengths, and energy levels will be automatically converted from cm<span>$^{-1}$</span> to eV.</li><li><code>&quot;kurucz&quot;</code> for an atomic or molecular <a href="http://kurucz.harvard.edu/linelists.html">Kurucz linelist</a> <code>format=&quot;kurucz_vac&quot;</code> is to be used if the linelist is formatted in vacuum wavelengths, which is for linelists below 2000 Å. Be warned that Korg will not do this automatically.</li><li><code>&quot;moog&quot;</code> for a <a href="http://www.as.utexas.edu/%7Echris/moog.html">MOOG linelist</a> (doesn&#39;t support broadening parameters or dissociation energies, assumed to be in vacuum wavelengths).</li><li><code>&quot;moog_air&quot;</code> for a MOOG linelist in air wavelengths.</li><li><code>&quot;turbospectrum&quot;</code> for a <a href="https://github.com/bertrandplez/Turbospectrum2019/blob/master/DOC/Readme-Linelist_format_v.19">Turbospectrum linelist</a> in air wavelengths. Note that Korg doesn&#39;t make use of the (optional) orbital angular momentum quantum number, l, for the upper or lower levels, so it won&#39;t fall back on generic ABO recipes when the ABO parameters are not available. Korg&#39;s interpretation of the <code>fdamp</code> parameter is also slightly different from Turbospectrum&#39;s. See the documentation of the <code>vdW</code> parameter of <a href="../devdocs/#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Line</code></a> for details.  Korg will error if encounters an Unsoeld fudge factor, which it does not support.</li><li>&quot;turbospectrum_vac&quot; for a Turbospectrum linelist in vacuum wavelengths.</li><li>&quot;korg&quot; for a Korg linelist (saved with hdf5). If the filename ends in <code>.h5</code>, this will be used by default.</li></ul><p>For VALD, Turbospectrum, and Kurucz linelists with isotope information available, Korg will scale log gf values by isotopic abundance (unless VALD has already pre-scaled them), using isotopic abundances from <a href="https://www.nist.gov/pml/atomic-weights-and-isotopic-compositions-relative-atomic-masses">NIST</a> (<a href="../devdocs/#Korg.isotopic_abundances"><code>Korg.isotopic_abundances</code></a>). To use custom isotopic abundances, just pass <code>isotopic_abundances</code> with the same structure: a dict mapping atomic number to a dict mapping from atomic weight to abundance.  To use the isotopic abundances embedded in a Kurucz-formatted linelist, pass <code>isotopic_abundances=nothing</code>. Kurucz-formatted linelists will fall back on the isotopic adjustments embedded in the linelist when the isotope numbers are not in the <code>isotopic_abundances</code> dict.</p><p>Be warned that for linelists which are pre-scaled for isotopic abundance, the estimation of radiative broadening from log(gf) is not accurate.</p><p>See also: <a href="#Korg.load_ExoMol_linelist"><code>load_ExoMol_linelist</code></a>, <a href="../devdocs/#Korg.save_linelist-Tuple{Any, Any}"><code>save_linelist</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/linelist.jl#L276-L321">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.load_ExoMol_linelist" href="#Korg.load_ExoMol_linelist"><code>Korg.load_ExoMol_linelist</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">load_ExoMol_linelist(specs, states_file, transitions_file, upper_wavelength, lower_wavelength)</code></pre><p>Load a linelist from ExoMol. Returns a vector of <a href="../devdocs/#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Line</code></a>s, the same as <a href="#Korg.read_linelist"><code>read_linelist</code></a>.</p><p><strong>Arguments</strong></p><ul><li><code>spec</code>: the species, i.e. the molecule that the linelist is for</li><li><code>states_file</code>: the path to the ExoMol states file</li><li><code>transitions_file</code>: the path to the ExoMol, transitions file</li><li><code>upper_wavelength</code>: the upper limit of the wavelength range to load (Å)</li><li><code>lower_wavelength</code>: the lower limit of the wavelength range to load (Å)</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>line_strength_cutoff</code>: the cutoff for the line strength (default: -15) used to filter the linelist. See <a href="../devdocs/#Korg.approximate_line_strength-Tuple{Korg.Line, Any}"><code>approximate_line_strength</code></a> for more information.</li><li><code>T_line_strength</code>: the temperature (K) at which to evaluate the line strength (default: 3500.0)</li></ul><div class="admonition is-warning" id="Warning-2e90b3b560491071"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-2e90b3b560491071" title="Permalink"></a></header><div class="admonition-body"><p>This functionality is in beta.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/linelist.jl#L181-L203">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.read_model_atmosphere" href="#Korg.read_model_atmosphere"><code>Korg.read_model_atmosphere</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_model_atmosphere(filename)</code></pre><p>Parse the provided model atmosphere file in MARCS &quot;.mod&quot; format.  Returns either a <code>PlanarAtmosphere</code> or a <code>ShellAtmosphere</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/atmosphere.jl#L141-L146">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.interpolate_marcs" href="#Korg.interpolate_marcs"><code>Korg.interpolate_marcs</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">interpolate_marcs(Teff, logg, A_X; kwargs...)
interpolate_marcs(Teff, logg, m_H=0, alpha_m=0, C_m=0; kwargs...)</code></pre><p>Returns a model atmosphere computed by interpolating models from <a href="https://marcs.astro.uu.se/">MARCS</a> ((Gustafsson+ 2008)[https://ui.adsabs.harvard.edu/abs/2008A&amp;A...486..951G/abstract]). Along with <code>Teff</code> and <code>logg</code>, the atmosphere is specified by <code>m_H</code>, <code>alpha_m</code>, and <code>C_m</code>, which can be automatically determined from an <code>A_X</code> abundance vector (the recommended method, see <a href="#Korg.format_A_X"><code>format_A_X</code></a>). Note that the MARCS atmosphere models were constructed with the Grevesse+ 2007 solar abundances (<code>Korg.grevesse_2007_solar_abundances</code>). This is handled automatically when <code>A_X</code> is provided.</p><p><code>interpolate_marcs</code> uses three different interpolation schemes for different stellar parameter regimes. In the standard case the model atmosphere grid is <a href="https://dr17.sdss.org/sas/dr17/apogee/spectro/speclib/atmos/marcs/MARCS_v3_2016/Readme_MARCS_v3_2016.txt">the one generated for SDSS</a>, transformed and linearly interpolated. For cool dwarfs (<code>Teff</code> ≤ 4000 K, <code>logg</code> ≥ 3.5), the grid is resampled onto unchanging <code>tau_5000</code> values and interpolated with a cubic spline. For low-metallicity models (-5 ≤ <code>m_H</code> &lt; -2.5), a grid of standard composition (i.e. fixed alpha and C) atmospheres is used.  (The microturbulence is 1km/s for dwarfs and 2km/s for giants and the mass for spherical models is 1 solar mass.) The interpolation method is the same as in the standard case. See <a href="https://ui.adsabs.harvard.edu/abs/2023arXiv231019823W/abstract">Wheeler+ 2024</a> for more details and a discussion of errors introduced by model atmosphere interpolation. (Note that the cubic scheme for cool dwarfs is referred to as not-yet-implemented in the paper but is now available.)</p><p><strong>keyword arguments</strong></p><ul><li><code>spherical</code>: whether or not to return a ShellAtmosphere (as opposed to a PlanarAtmosphere).  By default true when <code>logg</code> &lt; 3.5.</li><li><code>solar_abundances</code>: (default: <code>grevesse_2007_solar_abundances</code>) The solar abundances to use when <code>A_X</code> is provided instead of <code>M_H</code>, <code>alpha_M</code>, and <code>C_M</code>. The default is chosen to match that of the atmosphere grid, and if you change it you are likely trying to do something else.</li><li><code>clamp_abundances</code>: (default: <code>false</code>) allowed only when specifying <code>A_X</code>. Whether or not to clamp the abundance parameters to be within range to avoid throwing an out of bounds error.</li><li><code>perturb_at_grid_values</code> (default: <code>true</code>): whether or not to add or a subtract a very small number to each parameter which is exactly at a grid value. This prevents null derivatives, which can cause problems for minimizers.</li><li><code>resampled_cubic_for_cool_dwarfs</code> (default: <code>true</code>): whether or not to used specialized method for cool dwarfs.</li><li><code>archives</code>: A tuple containing the atmosphere grids to use.  For testing purposes.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/atmosphere.jl#L267-L305">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.format_A_X" href="#Korg.format_A_X"><code>Korg.format_A_X</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">format_A_X(default_metals_H, default_alpha_H, abundances; kwargs... )</code></pre><p>Returns a 92 element vector containing abundances in <span>$A(X)$</span> (<span>$\log_{10}(X/H) + 12$</span>) format for elements from hydrogen to uranium.</p><p><strong>Arguments</strong></p><p>You can specify abundance with these positional arguments.  All are optional, but if <code>default_alpha_H</code> is provided, <code>default_metals_H</code> must be as well.</p><ul><li><code>default_metals_H</code> (default: 0), i.e. [metals/H] is the <span>$\log_{10}$</span> solar-relative abundance of elements heavier than He. It is overridden by <code>default_alpha</code> and <code>abundances</code> on a per-element basis.</li><li><code>default_alpha_H</code> (default: same as <code>default_metals_H</code>), i.e. [alpha/H] is the <span>$\log_{10}$</span> solar-relative abundance of the alpha elements (See <code>alpha_elements</code>, below). It is overridden by <code>abundances</code> on a per-element basis.</li><li><code>abundances</code> is a <code>Dict</code> mapping atomic numbers or symbols to [<span>$X$</span>/H] abundances.  (Set <code>solar_relative=false</code> to use <span>$A(X)$</span> abundances instead.) These override <code>default_metals_H</code>. This is the only way to specify an abundance of He that is non-solar.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>solar_relative</code> (default: true): When true, interpret abundances as being in [<span>$X$</span>/H] (<span>$\log_{10}$</span> solar-relative) format.  When false, interpret them as <span>$A(X)$</span> abundances, i.e. <span>$A(x) = \log_{10}(n_X/n_\mathrm{H}) + 12$</span>, where <span>$n_X$</span> is the number density of <span>$X$</span>. Note that abundances not specified default to the solar value still depend on the solar value, as they are set according to <code>default_metals_H</code> and <code>default_alpha_H</code>.</li><li><code>solar_abundances</code> (default: <code>Korg.asplund_2020_solar_abundances</code>) is the set of solar abundances to use, as a vector indexed by atomic number. <code>Korg.asplund_2009_solar_abundances</code> and <code>Korg.grevesse_2007_solar_abundances</code> are also provided for convenience.</li><li><code>alpha_elements</code> (default: <a href="../devdocs/#Korg.default_alpha_elements"><code>Korg.default_alpha_elements</code></a>): vector of atomic numbers of the alpha elements. (Useful since conventions vary.)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/abundances.jl#L12-L44">source</a></section></article><h2 id="Built-in-linelists"><a class="docs-heading-anchor" href="#Built-in-linelists">Built-in linelists</a><a id="Built-in-linelists-1"></a><a class="docs-heading-anchor-permalink" href="#Built-in-linelists" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.get_APOGEE_DR17_linelist" href="#Korg.get_APOGEE_DR17_linelist"><code>Korg.get_APOGEE_DR17_linelist</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_APOGEE_DR17_linelist(; include_water=true)</code></pre><p>The APOGEE DR 17 linelist.  It ranges from roughly 15,000 Å to 17,000 Å.  It is nearly the same at the DR 16 linelist described in <a href="https://ui.adsabs.harvard.edu/abs/2021AJ....161..254S/abstract">Smith+ 2021</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/linelist.jl#L775-L781">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.get_GALAH_DR3_linelist" href="#Korg.get_GALAH_DR3_linelist"><code>Korg.get_GALAH_DR3_linelist</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_GALAH_DR3_linelist()</code></pre><p>The GALAH <a href="https://www.galah-survey.org/dr3/overview/">DR 3</a> linelist (also used for <a href="https://github.com/svenbuder/GALAH_DR4">DR 4</a>). It ranges from roughly 4,675 Å to 7,930 Å. This linelist is based on, but distinct from <a href="https://ui.adsabs.harvard.edu/abs/2021A%26A...645A.106H/">Heiter 2021</a>. See <a href="https://ui.adsabs.harvard.edu/abs/2021MNRAS.506..150B%2F/abstract">Buder et al. 2021</a> for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/linelist.jl#L805-L815">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.get_GES_linelist" href="#Korg.get_GES_linelist"><code>Korg.get_GES_linelist</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_GES_linelist()</code></pre><p>The Gaia-ESO survey linelist from <a href="https://ui.adsabs.harvard.edu/abs/2021A&amp;A...645A.106H/abstract">Heiter et al. 2021</a>.  This linelist contains &gt; 15 million lines, which means that it can take a while to synthesize spectra.  If you don&#39;t need molecular lines, you can set <code>include_molecules=false</code> to speed things up.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>include_molecules</code> (default: <code>true</code>): whether to include molecular lines.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/linelist.jl#L844-L855">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.get_VALD_solar_linelist" href="#Korg.get_VALD_solar_linelist"><code>Korg.get_VALD_solar_linelist</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_VALD_solar_linelist()</code></pre><p>Get a VALD &quot;extract stellar&quot; linelist produced at solar parameters, with the &quot;threshold&quot; value set to 0.01.  It was downloaded on 2021-05-20. It is intended to be used for quick tests only.</p><p>If you use this in a paper, please <a href="https://www.astro.uu.se/valdwiki/Acknowledgement">cite VALD appropriately</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/linelist.jl#L763-L770">source</a></section></article><h1 id="Fitting"><a class="docs-heading-anchor" href="#Fitting">Fitting</a><a id="Fitting-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.Fit.fit_spectrum" href="#Korg.Fit.fit_spectrum"><code>Korg.Fit.fit_spectrum</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fit_spectrum(obs_wls, obs_flux, obs_err, linelist, initial_guesses, fixed_params; kwargs...)</code></pre><p>Find the parameters and abundances that best match a rectified observed spectrum.</p><p><strong>Arguments:</strong></p><ul><li><code>obs_wls</code>: the wavelengths of the observed spectrum in Å.  These must be vacuum wavelengths.</li><li><code>obs_flux</code>: the rectified flux of the observed spectrum</li><li><code>obs_err</code>: uncertainty in <code>flux</code></li><li><code>linelist</code>: a linelist to use for the synthesis</li><li><code>initial_guesses</code>: a NamedTuple specifying initial guesses for the parameters to be fit.  See &quot;Specifying parameters&quot; below.</li><li><code>fixed_params</code>: a NamedTuple specifying parameters to be held fixed. See &quot;Specifying parameters&quot; below.</li></ul><p><code>initial_guesses</code> and <code>fixed_params</code> can also be specified as Dicts instead of NamedTuples, which is more convenient when calling Korg from python.</p><p><strong>Specifying parameters</strong></p><p>Parameters are specified as named tuples or dictionaries. Named tuples look like this: <code>(Teff=5000, logg=4.5, m_H=0.0)</code>.  Single-element named tuples require a semicolon: <code>(; Teff=5000)</code>.</p><p><strong>Required parameters</strong></p><p><code>Teff</code> and <code>logg</code> <em>must</em> be specified in either <code>initial_guesses</code> or <code>fixed_params</code>.</p><p><strong>Optional Parameters</strong></p><p>These can be specified in either <code>initial_guesses</code> or <code>fixed_params</code>, but if they are not default values are used.</p><ul><li><code>m_H</code>: the metallicity of the star, in dex. Default: <code>0.0</code></li><li><code>alpha_H</code>: the alpha enhancement of the star, in dex. Default: <code>m_H</code>.  Note that, because of the parameter range supported by <a href="#Korg.interpolate_marcs"><code>Korg.interpolate_marcs</code></a>, only values within ±1 of <code>m_H</code> are supported.</li><li><code>vmic</code>: the microturbulence velocity, in km/s. Default: <code>1.0</code></li><li><code>vsini</code>: the projected rotational velocity of the star, in km/s. Default: <code>0.0</code>. See <a href="../devdocs/#Korg.apply_rotation"><code>Korg.apply_rotation</code></a> for details.</li><li><code>epsilon</code>: the linear limb-darkening coefficient. Default: <code>0.6</code>. Used for applying rotational broadening only.  See <a href="../devdocs/#Korg.apply_rotation"><code>Korg.apply_rotation</code></a> for details.</li><li>Individual elements, e.g. <code>Na</code>, specify the solar-relative ([X/H]) abundance of that element.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>R</code>, the resolution of the observed spectrum. This is required.  It can be specified as a function of wavelength, in which case it will be evaluated at the observed wavelengths.</li><li><code>windows</code> is a vector of wavelength pairs, each of which specifies a wavelength &quot;window&quot; to synthesize and contribute to the total χ². If not specified, the entire spectrum is used. Overlapping windows are automatically merged.</li><li><code>adjust_continuum</code> (default: <code>false</code>) if true, adjust the continuum with the best-fit linear correction within each window, minimizing the chi-squared between data and model at every step of the optimization.</li><li><code>wl_buffer</code> is the number of Å to add to each side of the synthesis range for each window.</li><li><code>time_limit</code> is the maximum number of seconds to spend in the optimizer. (default: <code>10_000</code>). The optimizer will only checks against the time limit after each step, so the actual wall time may exceed this limit.</li><li><code>precision</code> specifies the tolerance for the solver to accept a solution. The solver operates on transformed parameters, so <code>precision</code> doesn&#39;t translate straightforwardly to Teff, logg, etc, but the default value, <code>1e-4</code>, provides a theoretical worst-case tolerance of about 0.15 K in <code>Teff</code>, 0.0002 in <code>logg</code>, 0.0001 in <code>m_H</code>, and 0.0004 in detailed abundances. In practice the precision achieved by the optimizer is about 10x bigger than this.</li><li><code>postprocess</code> can be used to arbitrarilly transform the synthesized (and LSF-convolved) spectrum before calculating the chi2.  It should take the form <code>postprocess(flux, data, err)</code> and write its changes in-place to the flux array.</li><li><code>LSF_matrix</code>: this can be provedided along with <code>synthesis_wls</code> in place of specifying <code>R</code> if you have a precomputed custom LSF matrix.</li><li><code>synthesis_wls</code>: see <code>LSF_matrix</code> above. This can be a Korg.Wavelengths object or any arguments that can be passed to its constructor, e.g. a range or vector of ranges. Wavelengths are in Å.</li><li>Any additional keyword arguments will be passed to <a href="#Korg.synthesize"><code>Korg.synthesize</code></a> when synthesizing the spectra for the fit.</li></ul><p><strong>Returns</strong></p><p>A NamedTuple with the following fields:</p><ul><li><code>best_fit_params</code>: the best-fit parameters</li><li><code>best_fit_flux</code>: the best-fit flux, with LSF applied, resampled, and rectified.</li><li><code>obs_wl_mask</code>: a bitmask for <code>obs_wls</code> which selects the wavelengths used in the fit (i.e. those in the <code>windows</code>)</li><li><code>solver_result</code>: the result object from <code>Optim.jl</code></li><li><code>trace</code>: a vector of NamedTuples, each of which contains the parameters at each step of the optimization. This is empty for single parameter fits, because the underlying solver doesn&#39;t supply it.</li><li><code>covariance</code>: a pair <code>(params, Σ)</code> where <code>params</code> is vector of parameter name (providing an order), and <code>Σ</code> is an estimate of the covariance matrix of the parameters.  It is the approximate inverse hessian of the log likelihood at the best-fit parameter calculated by the BGFS algorithm, and should be interpreted with caution.</li></ul><div class="admonition is-success" id="Tip-7447347818bd4ff3"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-7447347818bd4ff3" title="Permalink"></a></header><div class="admonition-body"><p>This function takes a long time to compile the first time it is called. Compilation performance is significantly better on Julia 1.10+ than previous versions, so if you are using an older version of Julia, you may want to upgrade.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/Fit/fit_via_synthesis.jl#L214-L309">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.Fit.ews_to_abundances" href="#Korg.Fit.ews_to_abundances"><code>Korg.Fit.ews_to_abundances</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ews_to_abundances(atm, linelist, A_X, measured_EWs; kwargs...)
ews_to_abundances(params, linelist, measured_EWs; kwargs...)</code></pre><p>Compute per-line abundances on the linear part of the curve of growth given a model atmosphere and a list of lines with equivalent widths.</p><p><strong>Arguments:</strong></p><ul><li><code>atm</code>: the model atmosphere (see <a href="#Korg.read_model_atmosphere"><code>Korg.read_model_atmosphere</code></a> and <a href="#Korg.interpolate_marcs"><code>Korg.interpolate_marcs</code></a>).</li><li><code>linelist</code>: A vector of <a href="../devdocs/#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Korg.Line</code></a>s (see <a href="#Korg.read_linelist"><code>Korg.read_linelist</code></a>).  The lines must be sorted by wavelength.</li><li><code>A_X</code>: a vector containing the A(X) abundances (log(n<em>X/n</em>H) + 12) for elements from hydrogen to uranium (see <a href="#Korg.format_A_X"><code>Korg.format_A_X</code></a>). All syntheses are done with these abundances, so if the resulting abundances deviate significantly from these, you may wish to iterate.</li><li><code>measured_EWs</code>: a vector of equivalent widths (in mÅ)</li></ul><p>Alternatively, you can pass a vector of parameters like the one returned by <a href="#Korg.Fit.ews_to_stellar_parameters"><code>ews_to_stellar_parameters</code></a> instead of a model atmosphere and abundances vector. These should be in the order <code>[Teff, logg, vmic, m_H]</code>.</p><p><strong>Returns</strong></p><p>A vector of abundances (<code>A(X) = log10(n_X/n_H) + 12</code> format) for each line in<code>linelist</code>, and a vector of ∂A/∂log(EW) for each line.</p><p><strong>Optional arguments:</strong></p><ul><li><p><code>wl_step</code> (default: 0.01) is the resolution in Å at which to synthesize the spectrum around each line.</p></li><li><p><code>ew_window_size</code> (default: 2): the farthest (in Å) to consider equivalent width contributions for each line.  It&#39;s very important that this is large enough to include each line entirely.</p></li><li><p><code>blend_warn_threshold</code> (default: 0.01) is the minimum absorption between two lines allowed before triggering a warning that they may be blended.</p></li><li><p><code>finite_difference_delta_A</code> (default: 0.01): the step size in A(X) to use for the finite difference calculation of the curve of growth slope.</p></li><li><p><code>solar_abundances</code> (default: <code>Korg.default_solar_abundances</code>): the solar abundances to use for the calculation of A(X). Only used if <code>ews_to_abundances</code> is called with a vector of parameters instead of a model atmosphere and abundances vector.</p></li></ul><p>All other keyword arguments are passed to <a href="#Korg.synthesize"><code>Korg.synthesize</code></a> when synthesizing each line.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/Fit/fit_via_EWs.jl#L84-L127">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.Fit.ews_to_stellar_parameters" href="#Korg.Fit.ews_to_stellar_parameters"><code>Korg.Fit.ews_to_stellar_parameters</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ews_to_stellar_parameters(linelist, measured_EWs; kwargs...)</code></pre><p>Find stellar parameters from equivalent widths the &quot;old fashioned&quot; way.  This function finds the values of <span>$T_\mathrm{eff}$</span>, <span>$\log g$</span>, <span>$v_{mic}$</span>, and [m/H] which satisfy the following conditions (using a Newton-Raphson solver):</p><ul><li>The slope of the abundances of neutral lines with respect to lower excitation potential is zero.</li><li>The difference between the mean abundances of neutral and ionized lines is zero.</li><li>The slope of the abundances of neutral lines with respect to reduced equivalent width is zero.</li><li>The difference between the mean abundances of all lines and the model-atmosphere input [m/H] is zero. Here the &quot;slope&quot; refers to the slope of a linear fit to the abundances of the lines in question.</li></ul><p><strong>Arguments:</strong></p><ul><li><code>linelist</code>: A vector of <a href="../devdocs/#Korg.Line-Union{Tuple{F6}, Tuple{F5}, Tuple{F4}, Tuple{F3}, Tuple{F2}, Tuple{F1}, Tuple{F1, F2, Korg.Species, F3}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}}, Tuple{F1, F2, Korg.Species, F3, Union{Missing, F4}, Union{Missing, F5}, Union{Missing, Tuple{F6, F6}, F6}}} where {F1&lt;:Real, F2&lt;:Real, F3&lt;:Real, F4&lt;:Real, F5&lt;:Real, F6&lt;:Real}"><code>Korg.Line</code></a> objects (see <a href="#Korg.read_linelist"><code>Korg.read_linelist</code></a>).  The lines must be sorted by wavelength.</li><li><code>measured_EWs</code>: a vector of equivalent widths (in mÅ).</li></ul><p><strong>Returns:</strong></p><p>A pair, <code>(params, uncertainties)</code>, containing:</p><ul><li>the best-fit parameters: <code>[Teff, logg, vmic, [m/H]]</code> as a vector (with vmic in km/s)</li><li>the uncertainties in the parameters, propagated from the uncertainties in the equivalent widths, which estimated from the line-to-line scatter and assumed to be uncorrelated. This is not a particularly rigorous error estimate, but it is a good sanity check.</li></ul><div class="admonition is-info" id="Info-a27382d494986687"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-a27382d494986687" title="Permalink"></a></header><div class="admonition-body"><p>For now, this function is limited to the parameters supported by the SDSS MARCS grid, i.e. down to [m/H] = -2.5 at the lowest metallicity grid point.</p></div></div><p><strong>Keyword arguments:</strong></p><ul><li><p><code>abundance_adjustments</code> (default: <code>zeros(length(measured_EWs))</code>) is a vector of abundances adjustments to be applied to the lines. This is useful when doing a differential analysis.</p></li><li><p><code>Teff0</code> (default: 5000.0) is the starting guess for Teff</p></li><li><p><code>logg0</code> (default: 3.5) is the starting guess for logg</p></li><li><p><code>vmic0</code> (default: 1.0) is the starting guess for vmic. Note that this must be nonzero in order to avoid null derivatives. Very small values are fine.</p></li><li><p><code>m_H0</code> (default: 0.0) is the starting guess for [m/H]</p></li><li><p><code>tolerances</code> (default: <code>[1e-3, 1e-3, 1e-4, 1e-3]</code>) is the tolerance for the residuals each equation listed above. The solver stops when all residuals are less than the corresponding tolerance.</p></li><li><p><code>max_step_sizes</code> (default: <code>[1000.0, 1.0, 0.3, 0.5]</code>) is the maximum step size to take in each parameter direction.  This is used to prevent the solver from taking too large of a step and missing the solution.  Be particularly cautious with the vmic (third) parameter, as the unadjusted step size is often too large.</p></li><li><p><code>parameter_ranges</code> (default: <code>[(2800.0, 8000.0), (-0.5, 5.5), (1e-3, 10.0), (-2.5, 1.0)]</code>) is the allowed range for each parameter. This is used to prevent the solver from wandering into unphysical parameter space, or outside the range of the SDSS MARCS grid supported by <a href="#Korg.interpolate_marcs"><code>Korg.interpolate_marcs</code></a>. The default ranges for <span>$T_\mathrm{eff}$</span>, <span>$\log g$</span>, and [m/H] are the widest supported by the MARCS grid. The minimum value for <code>vmic</code> is set to 1e-3 km/s to avoid null derivatives in the optimization.</p></li><li><p><code>fix_params</code> (default: <code>[false, false, false, false]</code>) is a vector of booleans indicating which parameters should be held fixed during the optimization. The order is [Teff, logg, vmic, [m/H]].</p></li><li><p><code>solar_abundances</code> (default: <a href="../devdocs/#Korg.default_solar_abundances"><code>Korg.default_solar_abundances</code></a>) the solar abundances to assume</p></li><li><p><code>verbose</code> (default: <code>false</code>) is a boolean indicating whether to print verbose output during the optimization. Works, by default, by adding a callback that prints the current parameters, residuals, and abundances. The callback can be explicitly set with the <code>callback</code> keyword.</p></li><li><p><code>callback</code>: is a function which is called at each step of the optimization. It is passed three arguments:</p><ul><li>the current values of the parameters [Teff, logg, vmic, [m/H]]</li><li>the residuals of each equation being solved</li><li>the abundances of each line computed with the current parameters You can pass a callback function, to e.g. make a plot of the residuals at each step.</li></ul></li><li><p><code>max_iterations</code> (default: 30) is the maximum number of iterations to allow before stopping the optimization.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/Fit/fit_via_EWs.jl#L294-L364">source</a></section></article><h1 id="Secondary-functions"><a class="docs-heading-anchor" href="#Secondary-functions">Secondary functions</a><a id="Secondary-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Secondary-functions" title="Permalink"></a></h1><p>You don&#39;t need use these to synthesize spectra, but they might be relevant depending on what you are doing.</p><h2 id="Postprocessing"><a class="docs-heading-anchor" href="#Postprocessing">Postprocessing</a><a id="Postprocessing-1"></a><a class="docs-heading-anchor-permalink" href="#Postprocessing" title="Permalink"></a></h2><p>These are used to transform observational or synthetic spectra.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.apply_LSF" href="#Korg.apply_LSF"><code>Korg.apply_LSF</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">apply_LSF(flux, wls, R; window_size=4)</code></pre><p>Applies a gaussian line spread function the the spectrum with flux vector <code>flux</code> and wavelengths <code>wls</code> in any format accepted by synthesize, e.g. as a pair <code>(λstart, λstop)</code>) with constant spectral resolution (, <span>$R = \lambda/\Delta\lambda$</span>, where <span>$\Delta\lambda$</span> is the LSF FWHM.  The <code>window_size</code> argument specifies how far out to extend the convolution kernel in standard deviations.</p><p>For the best match to data, your wavelength range should extend a couple <span>$\Delta\lambda$</span> outside the region you are going to compare.</p><p>If you are convolving many spectra defined on the same wavelenths to observational resolution, you will get much better performance using <a href="#Korg.compute_LSF_matrix"><code>compute_LSF_matrix</code></a>.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>window_size</code> (default: 4): how far out to extend the convolution kernel in units of the LSF width (σ, not HWHM)</li><li><code>renormalize_edge</code> (default: <code>true</code>): whether or not to renormalize the LSF at the edge of the wl range.  This doen&#39;t matter as long as <code>synth_wls</code> extends to large and small enough wavelengths.</li></ul><div class="admonition is-warning" id="Warning-13d950d4d5264d00"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-13d950d4d5264d00" title="Permalink"></a></header><div class="admonition-body"><ul><li><p>This is a naive, slow implementation.  Do not use it when performance matters.</p></li><li><p><code>apply_LSF</code> will have weird behavior if your wavelength grid is not locally linearly-spaced. It is intended to be run on a fine wavelength grid, then downsampled to the observational (or otherwise desired) grid.</p></li></ul></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/utils.jl#L60-L87">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.compute_LSF_matrix" href="#Korg.compute_LSF_matrix"><code>Korg.compute_LSF_matrix</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_LSF_matrix(synth_wls, obs_wls, R; kwargs...)</code></pre><p>Construct a sparse matrix, which when multiplied with a flux vector defined over wavelenths <code>synth_wls</code>, applies a gaussian line spead function (LSF) and resamples to the wavelenths <code>obswls</code>.</p><p><strong>Arguments</strong></p><ul><li><code>synth_wls</code>: the synthesis wavelengths in any form recognized by <code>synthesize</code>, e.g. a pair containing a lower and upper bound in Å, a vector of pairs, or a vector of Julia range objects.</li><li><code>obs_wls</code>: the wavelengths of the observed spectrum</li><li><code>R</code>: the resolving power, <span>$R = \lambda/\Delta\lambda$</span></li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>window_size</code> (default: 4): how far out to extend the convolution kernel in units of the LSF width (σ, not HWHM)</li><li><code>verbose</code> (default: <code>true</code>): whether or not to emit warnings and information to stdout/stderr.</li><li><code>step_tolerance</code>: the maximum difference between adjacent wavelengths in <code>synth_wls</code> for them to be considered linearly spaced.  This is only used if <code>synth_wls</code> is a vector of wavelengths rather than a range or vector or ranges.</li></ul><p>For the best match to data, your wavelength range should extend a couple <span>$\Delta\lambda$</span> outside the region you are going to compare.</p><p><a href="#Korg.apply_LSF"><code>Korg.apply_LSF</code></a> can apply an LSF to a single flux vector efficiently. This function is relatively slow, but one the LSF matrix is constructed, convolving spectra to observational resolution via matrix multiplication is fast.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/utils.jl#L100-L127">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.air_to_vacuum" href="#Korg.air_to_vacuum"><code>Korg.air_to_vacuum</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">air_to_vacuum(λ; cgs=λ&lt;1)</code></pre><p>Convert λ from an air to vacuum.  λ is assumed to be in Å if it is ⩾ 1, in cm otherwise.  Formula from Birch and Downs (1994) via the VALD website.</p><p>See also: <a href="#Korg.vacuum_to_air"><code>vacuum_to_air</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/utils.jl#L217-L224">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.vacuum_to_air" href="#Korg.vacuum_to_air"><code>Korg.vacuum_to_air</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">vacuum_to_air(λ; cgs=λ&lt;1)</code></pre><p>convert λ from a vacuum to air.  λ is assumed to be in Å if it is ⩾ 1, in cm otherwise.  Formula from Birch and Downs (1994) via the VALD website.</p><p>See also: <a href="#Korg.air_to_vacuum"><code>air_to_vacuum</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/utils.jl#L238-L245">source</a></section></article><h2 id="Misc"><a class="docs-heading-anchor" href="#Misc">Misc</a><a id="Misc-1"></a><a class="docs-heading-anchor-permalink" href="#Misc" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.blackbody" href="#Korg.blackbody"><code>Korg.blackbody</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">blackbody(T, λ)</code></pre><p>The value of the Planck blackbody function for temperature <code>T</code> at wavelength <code>λ</code> [cm].</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/synthesize.jl#L361-L365">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.prune_linelist" href="#Korg.prune_linelist"><code>Korg.prune_linelist</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">prune_linelist(atm, linelist, A_X, wls...; threshold=1.0, sort=true, synthesis_kwargs...)</code></pre><p>Return the vector containing the strongest lines in  <code>linelist</code>, (optionally) sorted by approximate equivalent width.</p><p><strong>Arguments</strong></p><ul><li><code>atm</code>: the atmosphere model</li><li><code>linelist</code>: the linelist (a vector of <code>Line</code> objects)</li><li><code>A_X</code>: the abundance of each element (see <a href="#Korg.format_A_X"><code>format_A_X</code></a>)</li><li><code>wls...</code>: the wavelength ranges to synthesize over.  These are specified the same way as the <code>wls</code> for <a href="#Korg.synthesize"><code>synthesize</code></a>.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>threshold=0.1</code>: The threshold ratio in the line center absorption to the continuum absorption computed at the photosphere for a line to be included in the returned list. <code>0.1</code> is a reasonable default for getting a sense of what might be measurable in a high-res, high-quality spectrum, but it should not be used to create a linelist for synthesis.</li><li><code>sort_by_EW=true</code>: If <code>true</code>, the returned linelist will be sorted by approximate reduced equivalent width.  If <code>false</code>, the linelist will be in wavelength order. Leaving the list in wavelength order is much faster, but sorting by strength is useful for visualizing the strongest lines.</li><li><code>verbose=true</code>: If <code>true</code>, a progress bar will be displayed while measuring the EWs. All other kwargs are passed to internal calls to <a href="#Korg.synthesize"><code>synthesize</code></a>.</li><li><code>max_distance=0.0</code>, how far from <code>wls</code> lines can be (in Å) before they are excluded from the returned list.</li></ul><div class="admonition is-category-caution" id="Caution-1288e31dfb53c929"><header class="admonition-header">Caution<a class="admonition-anchor" href="#Caution-1288e31dfb53c929" title="Permalink"></a></header><div class="admonition-body"><p>While this function can be used to prune a linelist for synthesis, the default behavior too aggressive for this purpose.  Set a much lower threshold (e.g. <code>threshold=1e-4</code>) and use <code>sort_by_EW=false</code> if you are pruning the linelist to speedup synthesis.  Note that Korg will dynamically choose which lines to include even if you use a large linelist (see the <code>line_cutoff_threshold</code> keyword argument to <a href="#Korg.synthesize"><code>synthesize</code></a>).</p></div></div><p>See also <a href="#Korg.merge_close_lines"><code>merge_close_lines</code></a> if you are using this for plotting.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/prune_linelist.jl#L1-L38">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Korg.merge_close_lines" href="#Korg.merge_close_lines"><code>Korg.merge_close_lines</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">merge_close_lines(linelist; merge_distance=0.2)</code></pre><p>Produce a list of the species and wavelengths of the lines in <code>linelist</code>, merging lines of the same species that are within <code>merge_distance</code> (default: 0.2 Å).  This is useful for labeling lines in a plot after running <a href="#Korg.prune_linelist"><code>prune_linelist</code></a>.</p><p><strong>Arguments</strong></p><ul><li><code>linelist</code>: the linelist (a vector of <code>Line</code> objects)</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>merge_distance=0.2</code>: The maximum distance in Å between lines of the same species to be merged into a single entry</li></ul><p><strong>Returns</strong></p><p>A vector of tuples <code>(wl, wl_low, wl_high, species)</code> where <code>wl</code> is gf-weighted wavelength of each set of merged lines (Å), <code>wl_low</code> and <code>wl_high</code> are their highest and lowest wavelength, and <code>species</code> is a string (not a <code>Korg.Species</code>) identifying the species of the line. These will be in wavelength order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2c6859ba16712d57f8cb205a7b287fd0e4e675e8/src/prune_linelist.jl#L111-L133">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorials/">« Tutorials</a><a class="docs-footer-nextpage" href="../FAQ/">FAQ »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 29 August 2025 17:48">Friday 29 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
