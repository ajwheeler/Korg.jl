<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Developer Documentation · Korg</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Korg logo"/></a><div class="docs-package-name"><span class="docs-autofit">Korg</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Quickstart</a></li><li><a class="tocitem" href="../API/">Function Reference</a></li><li class="is-active"><a class="tocitem" href>Developer Documentation</a><ul class="internal"><li><a class="tocitem" href="#Code-guidelines"><span>Code guidelines</span></a></li><li><a class="tocitem" href="#Continuum-absorption"><span>Continuum absorption</span></a></li><li><a class="tocitem" href="#Experimental-support-for-bound-free-metal-absorption-coefficients"><span>Experimental support for bound-free metal absorption coefficients</span></a></li><li><a class="tocitem" href="#Complete-API"><span>Complete API</span></a></li></ul></li><li><a class="tocitem" href="../install/">Install</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Developer Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Developer Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ajwheeler/Korg.jl/blob/master/docs/src/devdocs.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p>This page contains info for people interested in contributing code to Korg.  If you  have questions, do not hesitate to ask.</p><h2 id="Code-guidelines"><a class="docs-heading-anchor" href="#Code-guidelines">Code guidelines</a><a id="Code-guidelines-1"></a><a class="docs-heading-anchor-permalink" href="#Code-guidelines" title="Permalink"></a></h2><ul><li>Try to be explicit about units throughout the code, particularly when not using CGS.</li><li>Whenever possible, calculations should be precise up to a factor of <span>$10^{-3}$</span>.  When it&#39;s easy and inexpensive, they should be precise to <span>$10^{-5}$</span> or better.  </li><li>Ensure types are generic enough to support dual numbers and autodifferentiation. </li><li>Limit lines to 100 characters.</li><li>Use ASCII characters in the names of functions that are part of the public API.</li><li>Unless they will never be called elsewhere, provide docstrings describing the inputs, assumptions and outputs of any functions you write.</li></ul><h2 id="Continuum-absorption"><a class="docs-heading-anchor" href="#Continuum-absorption">Continuum absorption</a><a id="Continuum-absorption-1"></a><a class="docs-heading-anchor-permalink" href="#Continuum-absorption" title="Permalink"></a></h2><p>Steps for implementing new continuum sources of absorption:</p><ul><li>Define a helper function that computes a single absorption coefficient (in units of cm⁻²). The function should accept <code>ν</code> (in Hz) and <code>T</code> (in K) as the first and second arguments, respectively. The convention is for it should share a name with the corresponding public function, but have an underscore pre-appended (e.g. we define <code>_H_I_bf</code> to help implement <code>H_I_bf</code>).</li><li>The public function is the function constructed and returned by <code>Korg.ContinuumAbsorption.bounds_checked_absorption</code> that wraps the above helper function. This wrapper function implements bounds-checking for <code>ν</code> and <code>T</code> and supports the keyword arguments described in <a href="../API/#Continuum-Absorption-Kwargs">Continuum Absorption Kwargs</a>.</li><li>Add a docstring describing the new function. At the very least, please describe any non-standard arguments and include a reference in the docstring to the source where the function was taken from.</li><li>Add a line to <code>doc/src/API.md</code> under the <code>Continuum absorption</code> heading to render the docstring of your new function.</li><li>Add a line to <code>total_continuum_absorption</code> that calls the new public function for absorption.</li></ul><p>The first two steps may not apply for sources that don&#39;t directly depend on <code>ν</code> and <code>T</code> (e.g. absorption from scattering).</p><h2 id="Experimental-support-for-bound-free-metal-absorption-coefficients"><a class="docs-heading-anchor" href="#Experimental-support-for-bound-free-metal-absorption-coefficients">Experimental support for bound-free metal absorption coefficients</a><a id="Experimental-support-for-bound-free-metal-absorption-coefficients-1"></a><a class="docs-heading-anchor-permalink" href="#Experimental-support-for-bound-free-metal-absorption-coefficients" title="Permalink"></a></h2><h3 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h3><p>Korg currently has experimental support for computing the absorption coefficient contribution from bound-free absorption by metals using data from the Opacity Project&#39;s online database, <a href="http://cdsweb.u-strasbg.fr/topbase/topbase.html">TOPbase</a>.</p><p>For a given species (e.g. neutral C or singly-ionized C) TOPbase provides many tables of bound-free cross-sections (without stimulated emission correction), as functions of wavelength. The  <code>weighted_bf_cross_section_TOPBase</code> can be used to compute the effective bound-free cross-section (including corrections from stimulated emission), assuming LTE, for the given species.</p><p>Our tentative plan for the future is to use <code>weighted_bf_cross_section_TOPBase</code> for each species to construct a 2D tables of the effective bound-free cross-section that can be interpolated over temperature and wavelength. However, in the short-term the <code>absorption_coef_bf_TOPBase</code> function (which calls <code>weighted_bf_cross_section_TOPBase</code>) can be used to directly compute the absorption coefficient from the TOPbase data.</p><h3 id="Data-Sources"><a class="docs-heading-anchor" href="#Data-Sources">Data Sources</a><a id="Data-Sources-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Sources" title="Permalink"></a></h3><p>Currently, to call <code>weighted_bf_cross_section_TOPBase</code> or <code>absorption_coef_bf_TOPBase</code> for a given species, a table is required from TOPbase that is the result of a <a href="http://cdsweb.u-strasbg.fr/topbase/xsections.html">photoionisation Cross Section query</a>. The query should only request data for a single species.</p><p>Precise details about the requirements of the query is provided in the docstring of <code>each_photo_ion_subtable</code>. Note that leading/trailing white-space can cause issues for the parsers of these tables. For examples of these tables, see the <code>TOPbase_cross_section_He_II.txt</code> and <code>TOPbase_cross_section_H_I.txt</code> files in the <code>test/data</code> directory.</p><p>The path to this table should be directly passed to <code>weighted_bf_cross_section_TOPBase</code> and <code>absorption_coef_bf_TOPBase</code> via the <code>cross_sec_file</code> keyword argument. Alternatively, the code supports searching for the table at the path <code>$KORG_OP_DIR/&lt;symbol&gt;_&lt;ion-state&gt;.txt</code>, where</p><ul><li><code>KORG_OP_DIR</code> is the name of an environment variable</li><li><code>&lt;symbol&gt;</code> is replaced with the species atomic symbol</li><li><code>&lt;ion-state&gt;</code> is replaced with the capitalized Roman numerals describing the ionization state.</li></ul><p>Examples of the base filename (under this environment variable approach) include <code>H_I.txt</code>, <code>He_I.txt</code>, <code>He_II.txt</code>, or <code>Al_III.txt</code>.</p><p>In the future, we also plan to add support for reading in photoionization tables from the <a href="https://norad.astronomy.osu.edu/#codes">NORAD-Atomic-Data webpage</a>. </p><div class="admonition is-warning"><header class="admonition-header">Caveats</header><div class="admonition-body"><p>Be aware that there are discrepancies between the theoretical energy levels computed by the Opacity Project and empirical measurements. This can be seen by looking at the plots produced by the <code>misc/gen_Opacity_Project_comparison_plot.jl</code> plot. To recover accurate UV opacities, <a href="https://ui.adsabs.harvard.edu/abs/2008A%26A...486..951G/abstract">Gustafsson+ 2008</a> needed to correct the precise photon energies in the tables for C I, Mg I, Al I, and Si I. Before providing full support for these opacities, we may want to consider making similar corrections.</p></div></div><h2 id="Complete-API"><a class="docs-heading-anchor" href="#Complete-API">Complete API</a><a id="Complete-API-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-API" title="Permalink"></a></h2><p>Here are all the documented methods in Korg.</p><article class="docstring"><header><a class="docstring-binding" id="Korg.Formula" href="#Korg.Formula"><code>Korg.Formula</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Represents an atom or molecule, irespective of its charge.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L4-L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.Line-Union{Tuple{F}, Tuple{F, F, Korg.Species, F}, Tuple{F, F, Korg.Species, F, Union{Missing, F}}, Tuple{F, F, Korg.Species, F, Union{Missing, F}, Union{Missing, F}}, Tuple{F, F, Korg.Species, F, Union{Missing, F}, Union{Missing, F}, Union{Missing, Tuple{F, F}, F}}} where F&lt;:Real" href="#Korg.Line-Union{Tuple{F}, Tuple{F, F, Korg.Species, F}, Tuple{F, F, Korg.Species, F, Union{Missing, F}}, Tuple{F, F, Korg.Species, F, Union{Missing, F}, Union{Missing, F}}, Tuple{F, F, Korg.Species, F, Union{Missing, F}, Union{Missing, F}, Union{Missing, Tuple{F, F}, F}}} where F&lt;:Real"><code>Korg.Line</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">Line(wl::F, log_gf::F, species::Species, E_lower::F, 
     gamma_rad::Union{F, Missing}=missing, gamma_stark::Union{F, Missing}=missing, 
     vdw::Union{F, Tuple{F, F}, Missing}, missing) where F &lt;: Real</code></pre><p>Construct a <code>Line</code>.  If any of <code>gamma_rad</code>, <code>gamma_stark</code>, or <code>vdW</code> are <code>missing</code>, guess them. <code>vdW</code> may be log(Γ<em>vdW) (assumed if negative), Γ</em>vdW (assumed if 0 &lt; <code>vdW</code> &lt; 1), or packed ABO  parameters (assumed if <code>vdW</code> &gt; 1).  It may also be passed as a Tuple, <code>(σ, α)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L181-L189">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.PlanarAtmosphere-Tuple{Korg.ShellAtmosphere}" href="#Korg.PlanarAtmosphere-Tuple{Korg.ShellAtmosphere}"><code>Korg.PlanarAtmosphere</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">PlanarAtmosphere(atm::ShellAtmosphere)</code></pre><p>Construct a planar atmosphere with the data from a shell atmosphere.  Mostly useful for testing.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/atmosphere.jl#L28-L32">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ShellAtmosphere-Tuple{Korg.PlanarAtmosphere, Any}" href="#Korg.ShellAtmosphere-Tuple{Korg.PlanarAtmosphere, Any}"><code>Korg.ShellAtmosphere</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ShellAtmosphere(atm::PlanarAtmosphere, R)</code></pre><p>Construct a shell atmosphere with the data from a planar atmosphere and an outer radius.  Mostly  useful for testing.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/atmosphere.jl#L38-L43">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.Species" href="#Korg.Species"><code>Korg.Species</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Represents an atom or molecule (a <code>Formula</code>) with a particular number of electrons (regardless of  their configuration).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L117-L120">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.Species-Tuple{AbstractString}" href="#Korg.Species-Tuple{AbstractString}"><code>Korg.Species</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">Species(code::AbstractString)</code></pre><p>Parse the &quot;species code&quot; as it is often specified in linelists and return a the &quot;astronomy&quot;  notation. 01.00 → &quot;H<em>I&quot;, 02.01 → &quot;He</em>II&quot;, 02.1000 → &quot;He<em>II&quot;, 0608 → &quot;CO</em>I&quot;, etc.  </p><p>To parse at compile time, use the <code>species</code> string macro, i.e. <code>species&quot;H I&quot;</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L126-L133">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg._plane_parallel_approximate_transfer_integral-Tuple{Any, Any, Any}" href="#Korg._plane_parallel_approximate_transfer_integral-Tuple{Any, Any, Any}"><code>Korg._plane_parallel_approximate_transfer_integral</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">_plane_parallel_approximate_transfer_integral(τ, m, b)</code></pre><p>The exact solution to <span>$\int (m\tau + b) E_2(\tau)$</span> d\tau$.</p><p>The exponential integral function, expint, captures the integral over the disk of the star to  get the emergent astrophysical flux. You can verify it by substituting the variable of integration  in the exponential integal, t, with mu=1/t.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L158-L166">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.air_to_vacuum-Tuple{Any}" href="#Korg.air_to_vacuum-Tuple{Any}"><code>Korg.air_to_vacuum</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">air_to_vacuum(λ; cgs=λ&lt;1)</code></pre><p>Convert λ from an air to vacuum.  λ is assumed to be in Å if it is ⩾ 1, in cm otherwise.  Formula  from Birch and Downs (1994) via the VALD website.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L62-L67">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.all_mu_transfer_integral-Tuple{Any, Any}" href="#Korg.all_mu_transfer_integral-Tuple{Any, Any}"><code>Korg.all_mu_transfer_integral</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">all_mu_transfer_integral(τ, S)</code></pre><p>Compute exactly the solution to the transfer integral obtained be linearly interpolating the source  function, <code>S</code> across optical depths <code>τ</code>, without approximating the factor of E₂(τ).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L115-L120">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.approximate_gammas-Tuple{Any, Any, Any}" href="#Korg.approximate_gammas-Tuple{Any, Any, Any}"><code>Korg.approximate_gammas</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">approximate_gammas(wl, species, E_lower; ionization_energies=Korg.ionization_energies)</code></pre><p>A simplified form of the Unsoeld (1955) approximation for van der Waals broadening and the  <a href="https://ui.adsabs.harvard.edu/abs/1971Obs....91..139C/abstract">Cowley 1971</a> approximation for  Stark broadening, evaluated at 10,000 K.  Used for atomic lines with no vdW and stark broadening info in the linelist.</p><p>Returns <code>(γ_stark</code>, <code>log10(γ_vdW))</code> in Hz, where these are the per-perturber quantities. For autoionizing lines (those for which E<em>upper &gt; χ), Returns 0.0 for γ</em>vdW.</p><p>In the calculation of <code>n*²</code>, uses the approximation that <span>$\overbar{r^2} = 5/2 {n^*}^4 / Z^2$</span> which neglects the dependence on the angular momentum quantum number, l, in the the form given by <a href="https://ui.adsabs.harvard.edu/abs/1967MNRAS.136..381W/abstract">Warner 1967</a> (the earliest english  work reporting the Unsoeld result).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L236-L252">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.approximate_radiative_gamma-Tuple{Any, Any}" href="#Korg.approximate_radiative_gamma-Tuple{Any, Any}"><code>Korg.approximate_radiative_gamma</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">approximate_radiative_gamma(wl, log_gf)</code></pre><p>Approximate radiate broadening parameter.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L224-L228">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.blackbody-Tuple{Any, Any}" href="#Korg.blackbody-Tuple{Any, Any}"><code>Korg.blackbody</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">blackbody(T, λ)</code></pre><p>The value of the Planck blackbody function for temperature <code>T</code> at wavelength <code>λ</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/synthesize.jl#L174-L178">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.constant_R_LSF-Union{Tuple{F}, Tuple{AbstractVector{F}, Any, Any}} where F&lt;:Real" href="#Korg.constant_R_LSF-Union{Tuple{F}, Tuple{AbstractVector{F}, Any, Any}} where F&lt;:Real"><code>Korg.constant_R_LSF</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">constant_R_LSF(flux, wls, R)</code></pre><p>Applies a gaussian line spread function the the spectrum with flux vector <code>flux</code> and wavelength vector <code>wls</code> with constant spectral resolution, <span>$R = \lambda/\Delta\lambda.$</span></p><p>For the best match to data, your wavelength range should extend a couple <span>$\Delta\lambda$</span> outside  the region you are going to compare.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><ul><li><p>This is a naive, slow implementation.  Do not use it when performance matters.</p></li><li><p><code>constant_R_LSF</code> will have weird behavior if your wavelength grid is not locally linearly-spaced.  It is intended to be run on a fine wavelength grid, then downsampled to the observational (or   otherwise desired) grid.</p></li></ul></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L6-L21">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.contained-Tuple{Real, Korg.Interval}" href="#Korg.contained-Tuple{Real, Korg.Interval}"><code>Korg.contained</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">contained(value, interval)</code></pre><p>Returns whether <code>value</code> is contained by <code>interval</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; contained(0.5, Interval(1.0,10.0))
false
julia&gt; contained(5.0, Interval(1.0,10.0))
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L168-L180">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.contained_slice-Tuple{AbstractVector, Korg.Interval}" href="#Korg.contained_slice-Tuple{AbstractVector, Korg.Interval}"><code>Korg.contained_slice</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">contained_slice(vals, interval)</code></pre><p>Returns a range of indices denoting the elements of <code>vals</code> (which are assumed to be sorted in  increasing order) that are contained by <code>interval</code>. When no entries are contained by interval, this returns <code>(1,0)</code> (which is a valid empty slice).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L184-L190">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.cumulative_trapezoid_rule!" href="#Korg.cumulative_trapezoid_rule!"><code>Korg.cumulative_trapezoid_rule!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">cumulative_trapezoid_rule!(out, xs, fs, [len=length(xs)])</code></pre><p>Approximate the closed integral of f(x) from the first element of <code>xs</code> to each element of <code>xs</code>  (up to <code>len</code>) with the trapezoid rule, given f values <code>fs</code>. </p><p>Assigns to the preallocated vector <code>out</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L182-L189">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.doppler_width-NTuple{4, Any}" href="#Korg.doppler_width-NTuple{4, Any}"><code>Korg.doppler_width</code></a> — <span class="docstring-category">Method</span></header><section><div><p>the width of the doppler-broadening profile</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L230">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.exponential_integral_2-Tuple{Any}" href="#Korg.exponential_integral_2-Tuple{Any}"><code>Korg.exponential_integral_2</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">exponential_integral_2(x)</code></pre><p>Approximate second order exponential integral, E_2(x).  This stiches together several series  expansions to get an approximation which is accurate within 1% for all <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L197-L202">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.get_absolute_abundances-Tuple{Any, Dict}" href="#Korg.get_absolute_abundances-Tuple{Any, Dict}"><code>Korg.get_absolute_abundances</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_absolute_abundances(metallicity, A_X)</code></pre><p>Calculate <span>$n_X/n_\mathrm{total}$</span> for each element X given some specified abundances, <span>$A(X)$</span>.  Use the  metallicity [<span>$X$</span>/H] to calculate those remaining from the solar values (except He).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/synthesize.jl#L143-L148">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.get_mass-Tuple{Korg.Formula}" href="#Korg.get_mass-Tuple{Korg.Formula}"><code>Korg.get_mass</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_mass(f::Formula)</code></pre><p>Returns the mass [g] of <code>f</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L107-L111">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.hydrogen_line_absorption!-NTuple{8, Any}" href="#Korg.hydrogen_line_absorption!-NTuple{8, Any}"><code>Korg.hydrogen_line_absorption!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">hydrogen_line_absorption(λs, T, nₑ, nH_I, UH_I, hline_stark_profiles, ξ; 
                              stark_window_size=3e-7, self_window_size=1e-6)</code></pre><p>Calculate contribution to the the absorption coefficient, α, from hydrogen lines in units of cm^-1, at wavelengths <code>λs</code>. For Halpha, Hbeta, and Hgamma, add the p-d approximated profiles from  <a href="https://ui.adsabs.harvard.edu/abs/2000A%26A...363.1091B/abstract">Barklem, Piskunovet, and O&#39;Mara 2000</a> to the absortion coefficient.  This &quot;convolution by summation&quot; is inexact, but true convolution is expensive.</p><p>Arguments:</p><ul><li><code>T</code>: temperature [K]</li><li><code>nₑ</code>: electron number density [cm^-3]</li><li><code>nH_I</code>: neutral hydrogen number density [cm^-3]</li><li><code>UH_I</code>: the value of the neutral hydrogen partition function</li><li><code>hline_stark_profiles</code>: (returned by setup<em>hline</em>stark_profiles`)</li><li><code>ξ</code>: microturbulent velocity [cm/s]. This is only applied to Hα-Hγ.  Other hydrogen lines profiles   are dominated by stark broadening, and the stark broadened profiles are pre-convolved with a   doppler profile.</li><li><code>stark_window_size</code>: the max distance from each line center [cm] at which to calculate the stark  broadening profile</li><li><code>self_window_size</code>: the max distance from each line center [cm] at which to calculate the line   absorption for Hα-Hγ (those dominated by self-broadening).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L146-L169">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.inverse_gaussian_density-Tuple{Any, Any}" href="#Korg.inverse_gaussian_density-Tuple{Any, Any}"><code>Korg.inverse_gaussian_density</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">inverse_gaussian_density(ρ, σ)</code></pre><p>Calculate the inverse of a (0-centered) Gaussian PDF with standard deviation <code>σ</code>, i.e. the value of  <code>x</code> for which <code>ρ = exp(-0.5 x^2/σ^2}) / √[2π]</code>, which is given by <code>σ √[-2 log (√[2π]σρ)]</code>.  Returns  0 when ρ is larger than any value taken on by the PDF.</p><p>See also: <a href="#Korg.inverse_lorentz_density-Tuple{Any, Any}"><code>inverse_lorentz_density</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L77-L85">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.inverse_lorentz_density-Tuple{Any, Any}" href="#Korg.inverse_lorentz_density-Tuple{Any, Any}"><code>Korg.inverse_lorentz_density</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">inverse_lorentz_density(ρ, γ)</code></pre><p>Calculate the inverse of a (0-centered) Lorentz PDF with width <code>γ</code>, i.e. the value of <code>x</code> for which  <code>ρ = 1 / (π γ (1 + x^2/γ^2))</code>, which is given by <code>√[γ/(πρ) - γ^2]</code>. Returns 0 when ρ is larger than  any value taken on by the PDF.</p><p>See also: <a href="#Korg.inverse_gaussian_density-Tuple{Any, Any}"><code>inverse_gaussian_density</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L94-L102">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ismolecule-Tuple{Korg.Formula}" href="#Korg.ismolecule-Tuple{Korg.Formula}"><code>Korg.ismolecule</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ismolecule(f::Formula)</code></pre><p><code>true</code> when <code>f</code> is composed of more than one atom</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L100-L104">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.line_absorption!-Tuple{Any, Any, Any, Any, Any, Dict, Dict, Any}" href="#Korg.line_absorption!-Tuple{Any, Any, Any, Any, Any, Dict, Dict, Any}"><code>Korg.line_absorption!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">line_absorption(linelist, λs, temp, nₑ, n_densities, partition_fns, ξ
               ; α_cntm=nothing, cutoff_threshold=1e-3, window_size=20.0*1e-8)</code></pre><p>Calculate the opacity coefficient, α, in units of cm^-1 from all lines in <code>linelist</code>, at wavelengths <code>λs</code> [cm^-1]. </p><p>other arguments:</p><ul><li><code>temp</code> the temerature in K</li><li><code>n_densities</code>, a Dict mapping species to absolute number density [cm^-3].</li><li><code>partition_fns</code>, a Dict containing the partition function of each species</li><li><code>ξ</code> is the microturbulent velocity in cm/s (n.b. NOT km/s)</li></ul><p>The three keyword arguments specify how the size of the window over which each line is calculated  is chosen.  </p><ul><li>If <code>α_cntm</code> is passed as a callable returning the continuum opacity as a function of  wavelength, the line window will extend to 4 doppler widths or the wavelength at which the Lorentz wings of the line are at <code>cutoff_threshold * α_cntm[line.wl]</code>, whichever is greater.    <code>cutoff_threshold</code> defaults to 1e-3.  </li><li>if <code>α_cntm</code> is not passed, defaults to <code>window_size</code>, which is 2e-7 (in cm, i.e. 20 Å) unless otherwise specified</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L5-L26">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.line_profile-NTuple{5, Real}" href="#Korg.line_profile-NTuple{5, Real}"><code>Korg.line_profile</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">line_profile(λ₀, invΔλ_D, Δλ_L, line_amplitude, λ)</code></pre><p>A voigt profile centered on λ₀ with Doppler width 1/<code>invΔλ_D</code> and Lorentz width <code>Δλ_L</code>  evaluated at <code>λ</code> (cm).  Note that this returns values in units of cm^-1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L292-L297">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.molecular_equilibrium-NTuple{4, Any}" href="#Korg.molecular_equilibrium-NTuple{4, Any}"><code>Korg.molecular_equilibrium</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">molecular_equilibrium(MEQS, T, nₜ, nₑ; x0)</code></pre><p>Iteratively solve for the number density of each species. Returns a <code>Dict</code> mapping species to number  densities.</p><p>arguments:</p><ul><li>the system of molecular equilibrium equations <code>MEQs</code> (the thing returned by </li></ul><p><code>molecular_equilibrium_equations</code>)</p><ul><li>the temperature <code>T</code>, </li><li>the number density of non-electron particles <code>nₜ</code></li><li>the electron number density <code>nₑ</code></li><li>optionally, <code>x0</code>, a starting point for the solver</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/statmech.jl#L120-L133">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.molecular_equilibrium_equations-NTuple{4, Any}" href="#Korg.molecular_equilibrium_equations-NTuple{4, Any}"><code>Korg.molecular_equilibrium_equations</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">molecular_equilibrium_equations(absolute_abundances, ironization_energies, partiation_fns, equilibrium_constants)</code></pre><p>Returns a NamedTuple representing the system of equations specifying molecular equilibrium.</p><p>arguments:</p><ul><li>A Dict of <code>absolute_abundances</code>, N<em>X/N</em>total</li><li>a Dict of ionization energies, <code>ionization_energies</code>.  The keys of act as a list of all atoms.</li><li>a Dict of partition functions, <code>partition_fns</code></li><li>a Dict of log molecular equilibrium constants, <code>equilibrium_constants</code>, in partial pressure form.  The keys of <code>equilibrium_constants</code> act as a list of all molecules.</li></ul><p>The system of equations is specified with the number densities of the neutral atoms as free  parameters.  Each equation specifies the conservation of a particular species, e.g. (simplified)</p><pre><code class="language-none">n(O) = n(CO) + n(OH) + n(O I) + n(O II) + n(O III).</code></pre><p>In this equation:</p><ul><li><code>n(O)</code>, the number density of oxygen atoms in any form comes <code>absolute_abundances</code> and the total</li></ul><p>number density (supplied later)</p><ul><li><code>n(O I)</code> is a free parameter.  The numerical solver is varying this to satisfy the system of  equations.</li><li><code>n(O II)</code>, and <code>n(O III)</code> come from the Saha (ionization) equation given <code>n(O I)</code></li><li><code>n(CO)</code> and <code>n(OH)</code> come from the molecular equilibrium constants K, which are precomputed  over a range of temperatures. </li></ul><p>Equilibrium constants are defined in terms of partial pressures, so e.g.</p><pre><code class="language-none">K(OH)  ==  (p(O) p(H)) / p(OH)  ==  (n(O) n(H)) / n(OH)) kT</code></pre><p>This could also be computed via a Saha equation involving the molecular partition function and  dissolution energy.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/statmech.jl#L52-L84">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.parse_fwf-Tuple{String, Any}" href="#Korg.parse_fwf-Tuple{String, Any}"><code>Korg.parse_fwf</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">parse_fwf(source, rowspec; datarow, lastrow)</code></pre><p>Parse fixed-width files, returning a vector of <code>NamedTuples</code>. <code>source</code> can be either an <code>AbstractVector</code> of <code>Strings</code> or a filename. <code>rowspec</code> should be a vector of tuples each containing, in order</p><ul><li>a range object corresponding to the column postion</li><li>the type.  Strings will be pulled directly &amp; other types will be parsed with <code>parse</code>.</li><li>the column name, a <code>Symbol</code>.</li><li>optionally, a function to apply to the parsed value.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L98-L108">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.planar_transfer-NTuple{4, Any}" href="#Korg.planar_transfer-NTuple{4, Any}"><code>Korg.planar_transfer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">planar_transfer(α, S, τ_ref, α_ref)</code></pre><p>Returns the astrophysical flux. See <a href="#Korg.radiative_transfer"><code>radiative_transfer</code></a> for an explantion of the arguments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L29-L33">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.radiative_transfer" href="#Korg.radiative_transfer"><code>Korg.radiative_transfer</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">radiative_transfer(atm::ModelAtmosphere, α, S, α_ref, mu_grid)</code></pre><p>Returns the astrophysical flux at each wavelength.</p><p>inputs:</p><ul><li><code>atm</code>: the model atmosphere.</li><li><code>α</code>: a matrix (atmospheric layers × wavelengths) containing the absoprtion coefficient</li><li><code>S</code>: the source fuction as a matrix of the same shape.</li><li><code>α_ref</code>: the continuum absoprtion coefficient at the reference wavelength (5000 Å). Used to   rescale the total absorption to match the model atmosphere. This value should be calculated by   Korg.</li><li><code>mu_grid</code>: (required if atm is a <a href="#Korg.ShellAtmosphere-Tuple{Korg.PlanarAtmosphere, Any}"><code>ShellAtmosphere</code></a>) the values of μ at which to calculate   the surface intensity, which is integrated to obtain the astrophysical flux.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L1-L15">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ray_transfer_integral-Tuple{Any, Any}" href="#Korg.ray_transfer_integral-Tuple{Any, Any}"><code>Korg.ray_transfer_integral</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ray_transfer_integral(τ, S)</code></pre><p>Compute exactly the solution to the transfer integral obtained be linearly interpolating the source  function, <code>S</code> across optical depths <code>τ</code>, without approximating the factor of exp(-τ).</p><p>This breaks the integral into the sum of integrals of the form  <span>$\int (m\tau + b) \exp(-\tau)$</span> d\tau$ ,  which is equal to $ -\exp(-\tau) (m*\tau + b + m)$.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L132-L142">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.read_linelist-Tuple{String}" href="#Korg.read_linelist-Tuple{String}"><code>Korg.read_linelist</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">read_linelist(filename; format=&quot;vald&quot;, isotopic_abundances=Korg.isotopic_abundances)</code></pre><p>Parse a linelist file, returning a vector of <a href="#Korg.Line-Union{Tuple{F}, Tuple{F, F, Korg.Species, F}, Tuple{F, F, Korg.Species, F, Union{Missing, F}}, Tuple{F, F, Korg.Species, F, Union{Missing, F}, Union{Missing, F}}, Tuple{F, F, Korg.Species, F, Union{Missing, F}, Union{Missing, F}, Union{Missing, Tuple{F, F}, F}}} where F&lt;:Real"><code>Line</code></a>s.</p><p>Pass <code>format=&quot;kurucz&quot;</code> for a <a href="http://kurucz.harvard.edu/linelists.html">Kurucz linelist</a>  (<code>format=kurucz_vac</code> if it uses vacuum wavelengths; Be warned that Korg will not assume that  wavelengths are vacuum below 2000 Å),<code>format=&quot;vald&quot;</code> for a  <a href="http://vald.astro.uu.se/~vald/php/vald.php">VALD</a> linelist, and <code>format=&quot;moog&quot;</code> for a MOOG linelist (doesn&#39;t support broadening parameters or dissociation energies).  </p><p>VALD linelists (the default and preferred format) can be either &quot;short&quot; or &quot;long&quot; format,  &quot;extract all&quot; or &quot;extract stellar&quot;.  Air wavelengths will automatically be converted into vacuum wavelengths, and energy levels will be automatically converted from cm<span>$^{-1}$</span> to eV.</p><p>When they are not pre-scaled by isotopic abundace (which VALD does by default), Korg will  automatically adjust the <code>log_gf</code> of each line according to <code>isotopic_abundances</code>, which defaults  to the values from <a href="https://www.nist.gov/pml/atomic-weights-and-isotopic-compositions-relative-atomic-masses">NIST</a>. To use custom isotopic abundances, just pass <code>isotopic_abundances</code> as a dictionary mapping <code>(atomic number, atomic weight)</code> pairs to abundances between 0 and 1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/linelist.jl#L289-L309">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.read_model_atmosphere-Tuple{AbstractString}" href="#Korg.read_model_atmosphere-Tuple{AbstractString}"><code>Korg.read_model_atmosphere</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">read_model_atmosphere(filename; truncate_at_10000K=true)</code></pre><p>Parse the provided model atmosphere file in MARCS &quot;.mod&quot; format.  Returns either a  <code>PlanarAtmosphere</code> or a <code>ShellAtmosphere</code>.</p><p>When <code>truncate_at_10000K</code> is true, layers with temperatures greater than 10,000 Kelvin will be  elided.  These are typically at the deepest level, where optical depth is very large, and have  minimal impact on the surface spectrum.  They are ignored by default because Korg&#39;s default  partition and molecular equillibrium functions are tabulated only up to that tempurature.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/atmosphere.jl#L54-L64">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.read_partition_funcs-Tuple{Any}" href="#Korg.read_partition_funcs-Tuple{Any}"><code>Korg.read_partition_funcs</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">functon read_atomic_partition_funcs([transform=identity])</code></pre><p>Constructs a Dict holding tables containing partition function or equilibrium constant values across ln(temperature).</p><p>The optional argument, <code>transform</code> is applied to each value. It is used to perform unit conversions, when loading equilibrium constants</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/read_statmech_quantities.jl#L58-L67">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.rectify-Union{Tuple{F}, Tuple{AbstractVector{F}, Any}} where F&lt;:Real" href="#Korg.rectify-Union{Tuple{F}, Tuple{AbstractVector{F}, Any}} where F&lt;:Real"><code>Korg.rectify</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">rectify(flux, wls; bandwidth=50, q=0.95, wl_step=1.0)</code></pre><p>Rectify the spectrum with flux vector <code>flux</code> and wavelengths <code>wls</code> by dividing out a moving <code>q</code>-quantile with window size <code>bandwidth</code>.  <code>wl_step</code> controls the size of the grid that the moving  quantile is calculated on and interpolated from.  Setting <code>wl_step</code> to 0 results in the exact  calculation with no interpolation, but note that this is very slow.  </p><p>Experiments on real spectra show an agreement between the interpolated rectified spectrum and the  &quot;exact&quot; one (with default values) at the 3 × 10^-4 level.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L37-L47">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.saha_ion_weights-Tuple{Any, Any, Any, Any, Dict}" href="#Korg.saha_ion_weights-Tuple{Any, Any, Any, Any, Dict}"><code>Korg.saha_ion_weights</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">saha_ion_weights(T, nₑ, atom, ionization_energies, partition_functions)</code></pre><p>Returns <code>(wII, wIII)</code>, where <code>wII</code> is the ratio of singly ionized to neutral atoms of a given  element, and <code>wIII</code> is the ration of doubly ionized to neutral atoms.</p><p>arguments:</p><ul><li>temperature <code>T</code> [K]</li><li>electron number density <code>nₑ</code> [cm^-3]</li><li>atom, the atomic number of the element </li><li><code>ionization_energies</code> is a collection indexed by integers (e.g. a <code>Vector</code>) mappping elements&#39;   atomic numbers to their first three ionization energies</li><li><code>partition_funcs</code> is a <code>Dict</code> mapping species to their partition functions</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/statmech.jl#L3-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.scaled_stark-Tuple{Any, Any}" href="#Korg.scaled_stark-Tuple{Any, Any}"><code>Korg.scaled_stark</code></a> — <span class="docstring-category">Method</span></header><section><div><p>the stark broadening gamma scaled acording to its temperature dependence</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L233">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.scaled_vdW" href="#Korg.scaled_vdW"><code>Korg.scaled_vdW</code></a> — <span class="docstring-category">Function</span></header><section><div><p>the vdW broadening gamma scaled acording to its temperature dependence, using either simple scaling  or ABO</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L236-L239">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.setup_equilibrium_constants-Tuple{}" href="#Korg.setup_equilibrium_constants-Tuple{}"><code>Korg.setup_equilibrium_constants</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">setup_equilibrium_constants()</code></pre><p>Returns a Dict holding the default (Barklem &amp; Collet 2016) log equilibrium constants, which are in pressure units.</p><p>In equation 7 in this paper, m is the reduced mass, m₁m₂/(m₁ + m₂).  This can be verified by  re-deriving the equilibrium constants from the partition functions and dissolution constants  provided by the paper.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/read_statmech_quantities.jl#L44-L53">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.setup_hydrogen_stark_profiles" href="#Korg.setup_hydrogen_stark_profiles"><code>Korg.setup_hydrogen_stark_profiles</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">load_hydrogen_stark_profiles()</code></pre><p>Load the (doppler-convolved) Stark-broadening profiles from disk.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L111-L115">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.setup_ionization_energies" href="#Korg.setup_ionization_energies"><code>Korg.setup_ionization_energies</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">setup_ionization_energies([filename])</code></pre><p>Parses the table of ionization energies and returns it as a dictionary mapping elements to their ionization energies, <code>[χ₁, χ₂, χ₃]</code> in eV.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/read_statmech_quantities.jl#L3-L8">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.setup_partition_funcs" href="#Korg.setup_partition_funcs"><code>Korg.setup_partition_funcs</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">setup_partition_funcs()</code></pre><p>Returns a Dict holding the default (Barklem &amp; Collet 2016) partition functions.</p><p>The partition function is linearly interpolated from values tabulated for the paper. The partition  functions can only be evaluated at temperatures between 1e-5 K and 1e4 K. The tabulated values were  NOT computed with a cutoff principle quantum number. This can lead to a couple percent error for  some neutral species in solar type stars (I think the problem becomes worse in hotter stars). See  the paper for more details.</p><p>Note that the paper seems to suggest that we could actually use cubic interpolation. That should be revisited in the future.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/read_statmech_quantities.jl#L25-L38">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.sigma_line-Tuple{Real}" href="#Korg.sigma_line-Tuple{Real}"><code>Korg.sigma_line</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">sigma_line(wl)</code></pre><p>The cross-section (divided by gf) at wavelength <code>wl</code> in Ångstroms of a transition for which the  product of the degeneracy and oscillator strength is <code>10^log_gf</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L276-L281">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.spherical_transfer-NTuple{6, Any}" href="#Korg.spherical_transfer-NTuple{6, Any}"><code>Korg.spherical_transfer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">spherical_transfer(α, S, τ_ref, α_ref, radii, μ_surface_grid)</code></pre><p>Perform radiative transfer along rays emerging at the μ values in <code>μ_surface_grid</code> in a spherically symmetric atmosphere resolved at radii <code>radii</code> [cm]. See <a href="#Korg.radiative_transfer"><code>radiative_transfer</code></a> for an  explantion of the arguments. Note that <code>radii</code> should be in decreasing order.</p><p>Returns <code>(flux, intensity)</code>, where <code>flux</code> is the astrophysical flux, and <code>intensity</code>, a matrix of  shape (mu values × wavelengths), is the surface intensity as a function of μ.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L46-L55">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.synthesize" href="#Korg.synthesize"><code>Korg.synthesize</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">synthesize(atm, linelist, λ_start, λ_stop, [λ_step=0.01]; metallicity=0, abundances=Dict(), vmic=0, ... )</code></pre><p>Solve the transfer equation in the model atmosphere <code>atm</code> with the transitions in <code>linelist</code> at the  from <code>λ_start</code> to <code>λ_stop</code> in steps of <code>λ_step</code> (all Å) to get the resultant astrophysical flux at  each wavelength.  An <code>AbstractRange</code> can also be probvided directly in place of <code>λ_start</code>, <code>λ_stop</code>, and <code>λ_step</code>.</p><p>Returns a named tuple with keys:</p><ul><li><code>flux</code>: the output spectrum</li><li><code>alpha</code>: the linear absorption coefficient at each wavelenth and atmospheric layer a Matrix of   size (layers x wavelengths)</li><li><code>number_densities</code>: A dictionary mapping <code>Species</code> to vectors of number densities at each   atmospheric layer</li><li><code>wavelengths</code>: The vacuum wavelenths (in Å) over which the synthesis was performed.  If  <code>air_wavelengths=true</code> this will not be the same as the input wavelenths.</li></ul><p>Optional arguments:</p><ul><li><code>metallicity</code>, i.e. [metals/H] is log_10 solar relative</li><li><code>abundances</code> is a <code>Dict</code> mapping atomic symbols to <span>$A(X)$</span> format abundances, i.e.   <span>$A(x) = \log_{10}(n_X/n_\mathrm{H}) + 12$</span>, where <span>$n_X$</span> is the number density of <span>$X$</span>.  These override <code>metallicity</code>.</li><li><code>vmic</code> (default: 0) is the microturbulent velocity, <span>$\xi$</span>, in km/s.</li><li><code>air_wavelengths</code> (default: <code>false</code>): Whether or not the input wavelengths are air wavelenths to   be converted to vacuum wavelengths by Korg.  The conversion will not be exact, so that the   wavelenth range can internally be represented by an evenly-spaced range.  If the approximation   error is greater than <code>wavelength_conversion_warn_threshold</code>, an error will be thrown. (To do   wavelength conversions yourself, see <a href="../API/#Korg.air_to_vacuum"><code>air_to_vacuum</code></a> and <a href="../API/#Korg.vacuum_to_air"><code>vacuum_to_air</code></a>.)</li><li><code>wavelength_conversion_warn_threshold</code> (default: 1e-4): see <code>air_wavelengths</code>.</li><li><code>line_buffer</code> (default: 10): the farthest (in Å) any line can be from the provided wavelenth range   before it is discarded.  If the edge of your window is near a strong line, you may have to turn   this up.</li><li><code>cntm_step</code> (default 1): the distance (in Å) between point at which the continuum opacity is  calculated.</li><li><code>hydrogen_lines</code> (default: <code>true</code>): whether or not to include H lines in the synthesis.</li><li><code>mu_grid</code>: the range of (surface) μ values at which to calculate the surface flux when doing   transfer in spherical geometry (when <code>atm</code> is a <code>ShellAtmosphere</code>).</li><li><code>line_cutoff_threshold</code> (default: <code>1e-3</code>): the fraction of the continuum absorption coefficient   at which line profiles are truncated.  This has major performance impacts, since line absorption  calculations dominate more syntheses.  Turn it down for more precision at the expense of runtime.  The default value should effect final spectra below the 10^-3 level.</li><li><code>ionization_energies</code>, a <code>Dict</code> mapping <code>Species</code> to their first three ionization energies,   defaults to <code>Korg.ionization_energies</code>.</li><li><code>partition_funcs</code>, a <code>Dict</code> mapping <code>Species</code> to partition functions (in terms of ln(T)). Defaults   to data from Barklem &amp; Collet 2016, <code>Korg.partition_funcs</code>.</li><li><code>equilibrium_constants</code>, a <code>Dict</code> mapping <code>Species</code> representing diatomic molecules to their   molecular equilbrium constants in partial pressure form.  Defaults to data from   Barklem and Collet 2016, <code>Korg.equilibrium_constants</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/synthesize.jl#L4-L52">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.translational_U-Tuple{Any, Any}" href="#Korg.translational_U-Tuple{Any, Any}"><code>Korg.translational_U</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">translational_U(m, T)</code></pre><p>The (inverse) contribution to the partition function from the free movement of a particle. Used in the Saha equation.</p><p>arguments</p><ul><li><code>m</code> is the particle mass</li><li><code>T</code> is the temperature in K</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/statmech.jl#L36-L45">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.trapezoid_rule-Tuple{Any, Any}" href="#Korg.trapezoid_rule-Tuple{Any, Any}"><code>Korg.trapezoid_rule</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">trapezoid_rule(xs, fs)</code></pre><p>Approximate the integral f(x) with the trapezoid rule over x-values <code>xs</code> given f(x) values <code>fs</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/transfer.jl#L171-L175">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.vacuum_to_air-Tuple{Any}" href="#Korg.vacuum_to_air-Tuple{Any}"><code>Korg.vacuum_to_air</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">vacuum_to_air(λ; cgs=λ&lt;1)</code></pre><p>convert λ from a vacuum to air.  λ is assumed to be in Å if it is ⩾ 1, in cm otherwise.  Formula  from Birch and Downs (1994) via the VALD website.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L80-L85">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.voigt-Tuple{Any, Any}" href="#Korg.voigt-Tuple{Any, Any}"><code>Korg.voigt</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">voigt(α, v)</code></pre><p>The <a href="https://en.wikipedia.org/wiki/Voigt_profile#Voigt_functions">voigt function</a>, <span>$H$</span>. Approximation from Hunger 1965.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/line_absorption.jl#L321-L326">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.λ_to_ν_bound-Tuple{Korg.Interval}" href="#Korg.λ_to_ν_bound-Tuple{Korg.Interval}"><code>Korg.λ_to_ν_bound</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">λ_to_ν_bound(λ_bound)</code></pre><p>Converts a λ <code>Inverval</code> (in cm) to an equivalent ν <code>Interval</code> (in Hz), correctly accounting for  tricky floating point details at the bounds.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/utils.jl#L218-L223">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.StateID" href="#Korg.ContinuumAbsorption.StateID"><code>Korg.ContinuumAbsorption.StateID</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">StateID(iSLP, iLV)</code></pre><p><code>StateID</code> represents a given state (electron configuration) of an ion species. The arguments are taken from the TOPBase.</p><p><strong>Arguments</strong></p><ul><li><code>iSLP::UInt16</code>: An integer representing the quantum atomic numbers SLπ (total spin, orbital angular momentum, and parity). The value is given by <code>100*(2*S+1) + 10*L + π</code>. Note that TOPBase documentation refers to the parity quantum number as P or π, but for consistency with how TOPBase presents the data, we prefer P in our implementation code.</li><li><code>iLV::UInt8</code>: Distinguishes between configurations that have the same values of <code>iSLP</code>. TOPBase seems to index the configuration based on the energy level of the configuration (with <code>iLV = 1</code> corresponding to the lowest energy).</li></ul><p><strong>Notes</strong></p><p>The combination of this struct and an ion species (or neutral element) should be enough to fully specify a given electron configuration. For example, consider He I:</p><ul><li><code>iSLP = 100, iLV = 1</code> has the electron configuration: 1s²</li><li><code>iSLP = 100, iLV = 2</code> has the electron configuration: 1s 2s</li><li><code>iSLP = 100, iLV = 3</code> has the electron configuration: 1s 3s</li><li><code>iSLP = 111, iLV = 1</code> has the electron configuration: 1s 2p</li><li><code>iSLP = 111, iLV = 2</code> has the electron configuration: 1s 3p</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/absorption_metal.jl#L7-L30">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.StateProp" href="#Korg.ContinuumAbsorption.StateProp"><code>Korg.ContinuumAbsorption.StateProp</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">StateProp(ion_energy_ryd, excitation_potential_ryd, statistical_weight, electron_config)</code></pre><p><code>StateProp</code> holds data associated with different electron configurations. It&#39;s used to hold data read from the TOPBase cross-section queries and to compute the statistical weight.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/absorption_metal.jl#L63-L68">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption._Hminus_bf_cross_section-Tuple{Any, Any}" href="#Korg.ContinuumAbsorption._Hminus_bf_cross_section-Tuple{Any, Any}"><code>Korg.ContinuumAbsorption._Hminus_bf_cross_section</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">_Hminus_bf_cross_section(λ, ion_energy_H⁻)</code></pre><p>Compute the H⁻ bound-free cross-section at a given wavelength (specified in Å). The cross-section  has units of megabarns per H⁻ particle and does NOT include a correction for stimulated emission.</p><p>This function linearly interpolates the table provided in Wishart (1979).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/absorption_H.jl#L119-L126">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption._hydrogenic_bf_high_n_absorption-Tuple{Real, Real, Integer, Integer, Real, Real}" href="#Korg.ContinuumAbsorption._hydrogenic_bf_high_n_absorption-Tuple{Real, Real, Integer, Integer, Real, Real}"><code>Korg.ContinuumAbsorption._hydrogenic_bf_high_n_absorption</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">_hydrogenic_bf_high_n_absorption(ν, T, Z, nmin, nsdens_div_partition, ion_energy)</code></pre><p>Approximates the sum of absorption coefficient contributions by all bound-free transitions in which the electron originates in an energy level of nmin or larger using an integral.</p><p>In full detail, the calculated quantity is described as     ∑<em>{n&#39;=nmin}^∞ ndens(n=n&#39;) * α</em>ν(n=n&#39;) * (1 - exp(-hν/k/T))/ρ, where α(n=n&#39;) is the absorption coefficient for the bound-free atomic absorption coefficient (uncorrected for stimulated emission). This function approximates this sum with an integral.</p><p><strong>Arguments</strong></p><ul><li><code>ν</code>: frequency in Hz</li><li><code>T</code>: temperature in K</li><li><code>Z::Integer</code>: Z is the atomic number of the ion (1 for HI)</li><li><code>nmin::Integer</code>: The lowest energy level (principle quantum number) included in the calculation</li><li><code>nsdens_div_partition</code> is the number density of the current species divided by the  partition function.</li><li><code>ion_energy</code>: the ionization energy from the ground state (in eV).</li></ul><p><strong>Notes</strong></p><p>This is based on equation (5.6) from Kurucz (1970) (which give the formula for opacity). I think ρ was simply omitted from that equation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/hydrogenic_bf_ff.jl#L81-L104">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption._load_gauntff_table" href="#Korg.ContinuumAbsorption._load_gauntff_table"><code>Korg.ContinuumAbsorption._load_gauntff_table</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_load_gauntff_table([fname])</code></pre><p>Returns a table of thermally-averaged free-free Gaunt factors, and the values of log₁₀(γ²) and log₁₀(u) associated with each point.</p><p>This loads the non-relativistic free-free data published by <a href="https://ui.adsabs.harvard.edu/abs/2014MNRAS.444..420V/abstract">van Hoof et al. (2014)</a>.</p><p>Note: This function code could trivially be adapted to load the relativistic free-free gaunt factors published by <a href="https://ui.adsabs.harvard.edu/abs/2015MNRAS.449.2112V/abstract">van Hoof et al (2015)</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/hydrogenic_bf_ff.jl#L193-L205">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption._ndens_Hminus" href="#Korg.ContinuumAbsorption._ndens_Hminus"><code>Korg.ContinuumAbsorption._ndens_Hminus</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_ndens_Hminus(nH_I_div_partition, ne, T, ion_energy = _H⁻_ion_energy)</code></pre><p>Compute the number density of H⁻ (implements eqn 5.10 of Kurucz 1970). This is an application of the saha equation where the &quot;ground state&quot; is H⁻ and the &quot;first ionization state&quot; is H I. The partition function of H⁻ is 1 at all temperatures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/absorption_H.jl#L70-L76">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.absorption_coef_bf_TOPBase-Tuple{AbstractVector, AbstractVector, AbstractVector, Korg.Species}" href="#Korg.ContinuumAbsorption.absorption_coef_bf_TOPBase-Tuple{AbstractVector, AbstractVector, AbstractVector, Korg.Species}"><code>Korg.ContinuumAbsorption.absorption_coef_bf_TOPBase</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">absorption_coef_bf_TOPBase(λ, T, ndens_species, species; kwargs...)</code></pre><p>Computes the bound-free linear absorption coefficient, α, (in units of cm⁻¹) using data from the  Opacity Project (downloaded from TOPBase) and assuming LTE. The result is stored in a 2D array with a size given by <code>(length(λ), length(T))</code>.</p><p><strong>Arguments</strong></p><ul><li><code>λ::AbstractVector</code>: wavelengths (in cm) to compute α at.</li><li><code>T::AbstractVector</code>: temperatures (in K) to compute α at.</li><li><code>ndens_species::AbstractVector</code>: number density (in cm⁻³) of the species at each temperature  (this should have the same length as T).</li><li><code>species::Species</code>: the starting atom or atomic ion of the bound-free reaction.</li></ul><p><strong>Keyword Arguments</strong></p><p>This function accepts all the same keyword arguments as <code>weighted_bf_cross_section_TOPBase</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/absorption_metal.jl#L385-L401">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.bounds_checked_absorption-Tuple{Any}" href="#Korg.ContinuumAbsorption.bounds_checked_absorption-Tuple{Any}"><code>Korg.ContinuumAbsorption.bounds_checked_absorption</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">bounds_checked_absorption(func; ν_bound, temp_bound)</code></pre><p>Constructs a wrapped function that implements bounds checking and extrapolation</p><p><strong>Parameters</strong></p><ul><li><code>func</code>: a function that has a signature <code>f(ν::Real, T::Real, args...)::Real</code>, where <code>ν</code> is  frequency (in Hz) and <code>T</code> is temperature (in K)</li><li><code>ν_bound::Interval</code>: Interval of frequencies (in Hz) over which <code>func</code> is valid.</li><li><code>temp_bound::Interval</code>: Interval of temperatures (in K) over which <code>func</code> is valid.</li></ul><p>The resulting function will have this signature:</p><pre><code class="language-none">wrapped_func(ν::AbstractVector{&lt;:Real}, T::Real, args...; kwargs...)</code></pre><p><strong>Wrapped Function Parameters</strong></p><ul><li><code>ν::AbstractVector{&lt;:Real}</code>: sorted vector of frequencies (in Hz)</li><li><code>T::Real</code>: temperature (in K)</li><li><code>args...</code>: function-specific arguments</li></ul><p>For a description for the <code>kwargs...</code>, see <a href="../API/#Continuum-Absorption-Kwargs">Continuum Absorption Kwargs</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/bounds_checking.jl#L16-L38">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.each_photo_ion_subtable-Tuple{AbstractString}" href="#Korg.ContinuumAbsorption.each_photo_ion_subtable-Tuple{AbstractString}"><code>Korg.ContinuumAbsorption.each_photo_ion_subtable</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">each_photo_ion_subtable(filename::AbstractString)</code></pre><p>Create an iterable <code>EachPhotoIonSubtable</code> object for parsing photoionization cross-sections.</p><p>The input file is organized as a series of subtables. Each subtable provides the photoionization energies (make sure this isn&#39;t the energy of the photoionized electron) in Ryd, and the associated cross section (in megabarns) for a different state.</p><p>Each entry in the <code>EachPhotoIonSubtable</code> iterable provides a named tuple with the keys:</p><ul><li>name: holds the species name</li><li>state_id: holds a <code>StateID</code> instance</li><li>photon<em>energy</em>ryd: the photoionization values (check), in Ryd, stored in an array of Float32 vals</li><li>cross<em>section</em>MegaBarn: the associated photoionization cross-sections. This array should have the same shape and datatype as photon<em>energy</em>ryd</li></ul><p>The underlying file is only closed after the <code>EachPhotoIonSubtable</code> is garbage collected.</p><p>#Notes This implementation is not robust enough to deal with blank lines at the start or end of the file.</p><p>The table should have been produced by a <a href="http://cdsweb.u-strasbg.fr/topbase/xsections.html">TOPbase Photoionisation Cross Section query</a> that uses the following query options:</p><ul><li>Only a single atomic number and a single number of electrons is included in the query (other choices may yield too many results, which causes TOPBase to truncate output).</li><li>There isn&#39;t any limitation on the number the quantum numbers, the energy or the levels</li><li>The query request levels ordered in the &quot;Level order in each series&quot;</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/absorption_metal.jl#L126-L154">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.electron_scattering-Tuple{F} where F&lt;:Real" href="#Korg.ContinuumAbsorption.electron_scattering-Tuple{F} where F&lt;:Real"><code>Korg.ContinuumAbsorption.electron_scattering</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">electron_scattering(nₑ)</code></pre><p>Compute the linear absorption coefficient, α, from scattering off of free electrons. This has no wavelength dependence. It assumes isotropic scattering.  (See, e.g. Gray p 160.)</p><p><strong>Arguments</strong></p><ul><li><code>nₑ::F</code>: number density of free electrons (in cgs)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/scattering.jl#L44-L52">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.gaunt_ff_vanHoof-Tuple{Any, Any}" href="#Korg.ContinuumAbsorption.gaunt_ff_vanHoof-Tuple{Any, Any}"><code>Korg.ContinuumAbsorption.gaunt_ff_vanHoof</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">gaunt_ff_vanHoof(log_u, log_γ2)</code></pre><p>computes the thermally averaged, non-relativistic free-free gaunt factor by interpolating the table provided by <a href="https://ui.adsabs.harvard.edu/abs/2014MNRAS.444..420V">van Hoof et al. (2014)</a>.</p><p><strong>Arguments</strong></p><ul><li><code>log_u</code>: Equal to log₁₀(u) = log₁₀(h<em>ν/(k</em>Tₑ))</li><li><code>log_γ2</code>: Equal to log₁₀(γ²) = log₁₀(Rydberg<em>Z²/(k</em>Tₑ))</li></ul><p><code>Rydberg</code> is the &quot;infinite mass unit of energy&quot; and <code>Tₑ</code> is the temperature of free electrons (for our purposes, we assume that free electrons are in thermal equilibrium with ions and neutral species).</p><p><strong>Notes</strong></p><p>van Hoof et al. (2014) computed the associated data table with a non-relativistic approach, which is invalid at very high temperatures. They conclude (from comparisons with a different paper) that their &quot;results should be accurate up to electron temperatures of roughly 100 MK&quot;. This is more than adequate for stellar atmospheres. In <a href="https://ui.adsabs.harvard.edu/abs/2015MNRAS.449.2112V">van Hoof et al. (2015)</a>, they find that relativistic effects introduce a ∼0.75% at 100MK, for Z = 1 (when Z &gt; 1, the change is smaller).</p><p>This function currently uses linear interpolation. However, van Hoof et al. (2014) provides an implementation of a third-order Lagrange scheme, which &quot;reaches a relative precision better than 1.5e-4 everywhere.&quot; The C and Fortran implementations of this scheme can be found <a href="http://data.nublado.org/gauntff/">here</a>, and are copyrighted by a BSD-style license.</p><p>Earlier variants of this function used less-accurate data from section 5.1 of Kurucz (1970) that extended over a smaller interval of data. That table was originally derived from a figure in Karsas and Latter (1961) and it&#39;s now used for testing purposes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/hydrogenic_bf_ff.jl#L272-L303">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.hydrogenic_bf_absorption" href="#Korg.ContinuumAbsorption.hydrogenic_bf_absorption"><code>Korg.ContinuumAbsorption.hydrogenic_bf_absorption</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">hydrogenic_bf_absorption(ν, T, Z, nmax_explicit_sum, nsdens_div_partition,
                         ion_energy, [integrate_high_n])</code></pre><p>Compute the bound-free linear absorption coefficient contributed by all energy states of a Hydrogenic species</p><p>The calculation is broken into 2 parts: (i) the contributions of the lowest energy states are  explicitly summed and (ii) the contributions of the higher energy states are estimated with an  integral.</p><p><strong>Arguments</strong></p><ul><li><code>ν</code>: frequency in Hz</li><li><code>T</code>: temperature in K</li><li><code>Z::Integer</code>: Z is the atomic number of the species (e.g. 1 for H I or 2 for He II)</li><li><code>nsdens_div_partition</code> is the total number density of the species divided by the species&#39;s  partition function.</li><li><code>ion_energy</code>: the ionization energy from the ground state (in eV). This can be   estimated as Z²*Rydberg<em>H (Rydberg</em>H is the ionization energy of Hydrogen)</li><li><code>nmax_explicit_sum::Integer</code>: The highest energy level whose absorption contribution is included  in the explicit sum. The contributions from higher levels are included in the integral.</li><li><code>integrate_high_n::bool</code>: When this is <code>false</code>, bf absorption from higher energy states are not  estimated at all. Default is <code>true</code>.</li></ul><p><strong>Notes</strong></p><p>This follows the approach described in section 5.1 of Kurucz (1970).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/hydrogenic_bf_ff.jl#L142-L168">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.hydrogenic_ff_absorption-Tuple{Real, Real, Integer, Real, Real}" href="#Korg.ContinuumAbsorption.hydrogenic_ff_absorption-Tuple{Real, Real, Integer, Real, Real}"><code>Korg.ContinuumAbsorption.hydrogenic_ff_absorption</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">hydrogenic_ff_absorption(ν, T, Z, ni, ne)</code></pre><p>computes the free-free linear absorption coefficient for a hydrogenic species</p><p>The naming convention for free-free absorption is counter-intuitive. A free-free interaction is named as though the species interacting with the free electron had one more bound electron (in  other words it&#39;s named as though the free-electron and ion were bound together). In practice, this means that <code>ni</code> should refer to:</p><ul><li>the number density of H II if computing the H I free-free absorption</li><li>the number density of He III if computing the He II free-free absorption</li><li>the number density of Li IV if computing the Li III free-free absorption</li></ul><p><strong>Arguments</strong></p><ul><li><code>Z::Integer</code>: the charge of the ion. For example, this is 1 for ionized H.</li><li><code>ni</code>: the number density of the ion species in cm⁻³.</li><li><code>ne</code>: the number density of free electrons.</li><li><code>ν</code>: frequency in Hz</li><li><code>T</code>: temperature in K</li></ul><p><strong>Note</strong></p><p>This approach was adopted from equation 5.8 from section 5.1 of Kurucz (1970). Comparison against equation 5.18b of Rybicki &amp; Lightman (2004), reveals that the equation in Kurucz (1970) omits the dependence on ρ. According to Rybicki &amp; Lightman (2004) the free-free absorption coefficient (corrected for stimulated emission) is:</p><pre><code class="language-none">    α = coef * Z² *ne * ni * (1 - exp(-hplanck*ν/(kboltz*T))) * g_ff / (sqrt(T) * ν³)</code></pre><p>Note that the g_ff is the free-free gaunt factor and coef is ∼3.7e8 (a more exact coefficient can be computed from eqn 5.18a).</p><p>With this in mind, equation 5.8 of Kurucz (1970) should actually read</p><pre><code class="language-none">    κ = ne * n(H II) * F_ν(T) * (1 - exp(-hplanck*ν/(kboltz*T))) / ρ</code></pre><p>where F<em>ν(T) = coef * Z² * g</em>ff / (sqrt(T) * ν³).</p><p>See <code>gaunt_ff_vanHoof</code> for details about where our gaunt factor data comes from. For simplicity, we enforce temperature and ν bounds constraints that don&#39;t include all of the available gaunt factor data. In practice, this should never be a concern for stellar spectroscopy.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/hydrogenic_bf_ff.jl#L306-L346">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.ndens_state_hydrogenic-Tuple{Integer, Real, Real, Real}" href="#Korg.ContinuumAbsorption.ndens_state_hydrogenic-Tuple{Integer, Real, Real, Real}"><code>Korg.ContinuumAbsorption.ndens_state_hydrogenic</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">ndens_state_hydrogenic(n, nsdens_div_partition, ion_energy, T)</code></pre><p>Calculates the LTE number density (in cm^-3) of a hydrogenic species at a given energy level.</p><p><strong>Arguments</strong></p><ul><li><code>n::Integer</code>: The quantum number of the state</li><li><code>nsdens_div_partition</code>: The total (including all states) number density of the current </li></ul><p>ionization species (in cm^-3) divided by the species&#39;s partition function.</p><ul><li><code>ion_energy</code>: The minimum energy (in eV) required to ionize the species (from the ground </li></ul><p>state). This can be estimated as Z²<em>ion_energy of hydrogen or Z²</em>Rydberg_H.</p><ul><li><code>T</code>: Temperature</li></ul><p><strong>Note</strong></p><p>This assumes that all hydrogenic species have a statistical weight of gₙ = 2*n².</p><p>This was taken from equation (5.4) of Kurucz (1970) (although this comes directly from the  boltzmann equation).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/hydrogenic_bf_ff.jl#L6-L24">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.rayleigh-Tuple{AbstractVector{&lt;:Real}, Any, Any, Any}" href="#Korg.ContinuumAbsorption.rayleigh-Tuple{AbstractVector{&lt;:Real}, Any, Any, Any}"><code>Korg.ContinuumAbsorption.rayleigh</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">rayleigh(λs, nH_I, nHe_II, nH2)</code></pre><p>Absorption coefficient from Rayleigh scattering by neutral H, He, and H2.  Formulations for H and He are via <a href="https://ui.adsabs.harvard.edu/abs/2016ApJ...817..116C/abstract">Colgan+ 2016</a>.  Formulation  for H2 from  <a href="https://ui.adsabs.harvard.edu/abs/1962ApJ...136..690D/abstract">Dalgarno and Williams 1962</a>.</p><p>The Dalgarno and Williams H2 is applicable redward of 1300 Å.  Since Rayleigh scattering breaks down when the particle size to wavelength ratio gets large, we that all frequencies passed to this  function be equivalent to 1300 Å or greater.</p><p>The formulations for H is adapted from  <a href="https://ui.adsabs.harvard.edu/abs/1962ApJ...136..690D/abstract">Lee 2005</a>, which states that it is  applicable redward of Lyman alpha. See Colgan 2016 for details on He.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/scattering.jl#L1-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.total_continuum_absorption-Union{Tuple{F}, Tuple{AbstractVector{F}, F, F, Dict, Dict}} where F&lt;:Real" href="#Korg.ContinuumAbsorption.total_continuum_absorption-Union{Tuple{F}, Tuple{AbstractVector{F}, F, F, Dict, Dict}} where F&lt;:Real"><code>Korg.ContinuumAbsorption.total_continuum_absorption</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">total_continuum_absorption(νs, T, nₑ, number_densities, partition_funcs; error_oobounds)</code></pre><p>The total continuum linear absoprtion coefficient, α, at many frequencies, ν.</p><p><strong>Arguments</strong></p><ul><li><code>νs</code> are frequencies in Hz</li><li><code>T</code> is temperature in K</li><li><code>nₑ</code> is the electron number density in cm^-3</li><li><code>number_densities</code> is a <code>Dict</code> mapping each <code>Species</code> to its number density</li><li><code>partition_funcs</code> is a <code>Dict</code> mapping each <code>Species</code> to its partition function (e.g. <code>Korg.partition_funcs</code>)</li><li><code>error_oobounds::Bool</code> specifies the behavior of most continnum absorption sources when passed  frequencies or temperature values that are out of bounds for their implementation. When <code>false</code>  (the default), those absorption sources are ignored at those values. Otherwise, an error is  thrown.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>For efficiency reasons, <code>νs</code> must be sorted. While this function technically supports any  sorted <code>AbstractVector</code>, it is most effient when passed an  <code>AbstractRange</code>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/ContinuumAbsorption.jl#L27-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Korg.ContinuumAbsorption.weighted_bf_cross_section_TOPBase-Tuple{AbstractVector, AbstractVector, Korg.Species}" href="#Korg.ContinuumAbsorption.weighted_bf_cross_section_TOPBase-Tuple{AbstractVector, AbstractVector, Korg.Species}"><code>Korg.ContinuumAbsorption.weighted_bf_cross_section_TOPBase</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">weighted_bf_cross_section_TOPBase(λ_vals, T_vals, species; extrapolation_bc = 0.0
                                  cross_sec_file = nothing,
                                  partition_func = partition_funcs[species])</code></pre><p>Calculate the combined bound-free cross section (in cm²) of an ion species using data from the Opacity Project. The result is the mean of the the bound-free cross section of each electron state, weighted by their Boltzmann probabilities. It includes the LTE correction for stimulated emission.  The result is stored in a 2D array with a size given by <code>(length(λ_vals), length(T_vals))</code>.</p><p><strong>Arguments</strong></p><ul><li><code>λ_vals::AbstractVector</code>: wavelengths (in cm) to compute the cross sections at</li><li><code>T_vals::AbstractVector</code>: temperatures (in K) to compute the cross sections at</li><li><code>species::Species</code>: the starting atom or atomic ion of the bound-free reaction.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>extrapolation_bc</code>: Specifies handling of extrapolation during linear interpolation (this is passed to <code>Interpolations.LinearInterpolation</code>).</li><li><code>cross_sec_file</code>: Optional keyword that specifies the path to the text file that holds the cross-section subtables. When <code>nothing</code> (the default), this function tries to load the file from <code>$KORG_OP_DIR/&lt;atomic-symbol&gt;_&lt;ion-state&gt;.txt</code>. <code>&lt;atomic-symbol&gt;</code> is replaced with the atomic symbol of the species (e.g. <code>H</code>, <code>He</code>, <code>Al</code>) and <code>&lt;ion-state&gt;</code> is replaced with the  capital Roman numeral(s) specifying the ionization state.</li><li><code>partition_func</code>: Specifies the partition function for the current species. This should be a callable that accepts ln(temperature) as an argument. Defaults to the built-in values.</li></ul><p><strong>Explanation</strong></p><p>In more mathematical rigor, this function basically evaluates the following equation:</p><p><span>$\overline{\sigma_{\rm bf}}(\lambda,T) = \sum_{{\bf n}\in{\rm states}} \frac{ g_{\bf n}}{U(T)} e^{-E_{\bf n}/(k_B T)}\left(1 - e^{-h c/(\lambda k_B T)}\right) \sigma_{{\rm bf}, {\bf n}}(\lambda)$</span></p><p>In this equation:</p><ul><li><span>$g_{\bf n}$</span> is the statistical weight of state <span>${\bf n}$</span>.</li><li><span>$U$</span> is the partition function.</li><li><span>$E_{\bf n}$</span> is the excitation potential of state <span>${\bf n}$</span>. In other words, its the energy  difference between state <span>${\bf n}$</span> and the ground state.</li><li><span>$\sigma_{\lambda,{\rm bf}, {\bf n}}$</span> is the bound-free cross-section (a.k.a. photo-ionization cross section) of state <span>${\bf n}$</span>.</li></ul><p>The linear aborption coefficient for bound-free absorption is simply: <span>$\alpha_{\lambda,{\rm bf}} = n_{\rm tot} \overline{\sigma_{\rm bf}}(\lambda,T)$</span>.</p><p><strong>Notes</strong></p><p>In the future, it needs to be possible to pass an argument that adjusts the energy levels of different electron configurations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ajwheeler/Korg.jl/blob/2af64164a15c64354133f89f31e66035d3f2b4b5/src/continuum_absorption/absorption_metal.jl#L283-L328">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../API/">« Function Reference</a><a class="docs-footer-nextpage" href="../install/">Install »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 29 March 2022 03:37">Tuesday 29 March 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
