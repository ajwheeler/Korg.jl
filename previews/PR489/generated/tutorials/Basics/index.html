<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basics · Korg</title><meta name="title" content="Basics · Korg"/><meta property="og:title" content="Basics · Korg"/><meta property="twitter:title" content="Basics · Korg"/><meta name="description" content="Documentation for Korg."/><meta property="og:description" content="Documentation for Korg."/><meta property="twitter:description" content="Documentation for Korg."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="Korg logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Korg</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Quickstart</a></li><li><a class="tocitem" href="../../../install/">Install</a></li><li><a class="tocitem" href="../../../Upgrading/">Upgrading to v1.0</a></li><li><span class="tocitem">Guides</span><ul><li class="is-active"><a class="tocitem" href>Basics</a><ul class="internal"><li><a class="tocitem" href="#Choose-a-linelist"><span>Choose a linelist</span></a></li><li><a class="tocitem" href="#Specifying-abundances"><span>Specifying abundances</span></a></li><li><a class="tocitem" href="#synth-example"><span>A more complex example</span></a></li><li class="toplevel"><a class="tocitem" href="#Going-deeper:-synthesize"><span>Going deeper: <code>synthesize</code></span></a></li><li><a class="tocitem" href="#Abundances"><span>Abundances</span></a></li><li><a class="tocitem" href="#Model-Atmosphere"><span>Model Atmosphere</span></a></li><li><a class="tocitem" href="#Putting-it-all-together"><span>Putting it all together</span></a></li><li><a class="tocitem" href="#Per-species-number-densities"><span>Per-species number densities</span></a></li><li><a class="tocitem" href="#The-absorption-coefficient"><span>The absorption coefficient</span></a></li><li class="toplevel"><a class="tocitem" href="#Post-processing-your-spectrum"><span>Post-processing your spectrum</span></a></li><li><a class="tocitem" href="#LSF"><span>Line-spread function (LSF)</span></a></li><li><a class="tocitem" href="#Rotational-broadening"><span>Rotational broadening</span></a></li></ul></li><li><a class="tocitem" href="../Direct Fitting/">Direct Fitting</a></li><li><a class="tocitem" href="../Equivalent Widths/">Equivalent Widths</a></li><li><a class="tocitem" href="../Radial velocity precision/">Radial velocity precision</a></li><li><a class="tocitem" href="../../../tutorials/">Other Tutorials</a></li><li><a class="tocitem" href="../../../Abundances/">Abundances</a></li><li><a class="tocitem" href="../../../Wavelengths/">Wavelengths</a></li></ul></li><li><a class="tocitem" href="../../../API/">Public Functions</a></li><li><a class="tocitem" href="../../../FAQ/">FAQ</a></li><li><a class="tocitem" href="../../../devdocs/">Developer Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Guides</a></li><li class="is-active"><a href>Basics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ajwheeler/Korg.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ajwheeler/Korg.jl/blob/main/docs/src/Tutorials/Basics.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="../Basics.ipynb">Download this page as a Jupyter notebook</a></p><pre><code class="language-julia hljs">    using Korg, PythonPlot</code></pre><p>When you import with <code>using</code>, a few functions are imported directly into the namespace (<a href="../../../API/#Korg.synth"><code>synth</code></a>, <a href="../../../API/#Korg.synthesize"><code>synthesize</code></a>, <a href="../../../API/#Korg.interpolate_marcs"><code>interpolate_marcs</code></a>, <a href="../../../API/#Korg.format_A_X"><code>format_A_X</code></a>).  All other functions need to be accessed with the <code>Korg</code> prefix, e.g. <a href="../../../API/#Korg.air_to_vacuum"><code>Korg.air_to_vacuum</code></a>. These examples use the PythonPlot package, which provides a nice Julia interface to Matplotlib, but of course you can plot however you like.</p><h1 id="Synthesizing-a-spectrum-the-easy-way:-synth"><a class="docs-heading-anchor" href="#Synthesizing-a-spectrum-the-easy-way:-synth">Synthesizing a spectrum the easy way: <code>synth</code></a><a id="Synthesizing-a-spectrum-the-easy-way:-synth-1"></a><a class="docs-heading-anchor-permalink" href="#Synthesizing-a-spectrum-the-easy-way:-synth" title="Permalink"></a></h1><p>Synthesizing a spectrum is easy!</p><pre><code class="language-julia hljs">λs, flux, cntm = synth(; Teff=5777, logg=4.44, wavelengths=(5000, 5050))
plot(λs, flux, &quot;k-&quot;)
xlabel(&quot;λ [Å]&quot;)
ylabel(&quot;Flux&quot;)</code></pre><img src="b1973e7e.png" alt="Example block output"/><p>The <a href="../../../API/#Korg.synth"><code>synth</code></a> function is a one-stop shop for synthesizing a spectrum.  It takes many keyword arguments, but the only required ones are <code>Teff</code> (the effective temperature in Kelvin) and <code>logg</code> (the log surface gravity in cgs units).  Korg will automatically construct the model atmosphere by interpolating from its built-in grid of MARCS model atmospheres (taking abundances, as well as <code>Teff</code> and <code>logg</code>, into account).</p><p>Julia is just-in-time compiled, which means that the first time in each session you call a method (e.g. <code>synth</code>), the code will be compiled, which can take several seconds.  The first time you call a method, it may be slow, with lots of time devoted to compilation. When you call it a second time, it&#39;s much faster, because no code needs to be compiled. Note that no data is being cached and re-used here. Try calling <code>synth</code> again (changing the parameters if you like) to see the speedup.</p><p>You probably want to be able to control more than just the effective temperature, surface gravity, and wavelength range. Let&#39;s go over some of the other things you can set when calling <a href="../../../API/#Korg.synth"><code>synth</code></a>.</p><h2 id="Choose-a-linelist"><a class="docs-heading-anchor" href="#Choose-a-linelist">Choose a linelist</a><a id="Choose-a-linelist-1"></a><a class="docs-heading-anchor-permalink" href="#Choose-a-linelist" title="Permalink"></a></h2><p>A &quot;linelist&quot; is a list of atomic and molecular transitions to be included in the synthetic spectrum.  Korg supports the VALD, MOOG, Kurucz, and ExoMol format linelists (see <a href="../../../API/#Korg.read_linelist"><code>Korg.read_linelist</code></a>, <a href="../../../API/#Korg.load_ExoMol_linelist"><code>Korg.load_ExoMol_linelist</code></a>). It also has several built-in linelists for convenience:</p><ul><li><a href="../../../API/#Korg.get_VALD_solar_linelist"><code>Korg.get_VALD_solar_linelist</code></a> for the Sun from 3000 to 9000 Å.</li><li><a href="../../../API/#Korg.get_APOGEE_DR17_linelist"><code>Korg.get_APOGEE_DR17_linelist</code></a> for the latest APOGEE linelist</li><li><a href="../../../API/#Korg.get_GALAH_DR3_linelist"><code>Korg.get_GALAH_DR3_linelist</code></a> for the GALAH DR3 and DR4 linelist</li><li><a href="../../../API/#Korg.get_GES_linelist"><code>Korg.get_GES_linelist</code></a> for the Gaia ESO survey linelist</li></ul><p>Each linelist is a vector of <code>Korg.Line</code> objects, but you don&#39;t need to worry about the details if you just want to pass it into Korg.</p><pre><code class="language-julia hljs">vald_lines = Korg.get_VALD_solar_linelist() # lines for the Sun from 3000 to 9000 Å</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">41821-element Vector{Korg.Line{Float64, Float64, Float64, Float64, Float64, Float64}}:
 Fe I 3000.0414 Å (log gf = -2.96, χ = 3.3 eV)
 Fe I 3000.0639 Å (log gf = -0.96, χ = 2.43 eV)
 V I 3000.1011 Å (log gf = -0.48, χ = 1.19 eV)
 Cr II 3000.1718 Å (log gf = -1.49, χ = 3.86 eV)
 Fe I 3000.198 Å (log gf = -3.06, χ = 3.27 eV)
 Ta II 3000.2515 Å (log gf = 0.7, χ = 1.8 eV)
 Fe I 3000.2891 Å (log gf = -2.81, χ = 2.28 eV)
 Ce II 3000.3084 Å (log gf = -1.25, χ = 0.45 eV)
 Fe I 3000.3177 Å (log gf = -3.99, χ = 3.0 eV)
 Ce II 3000.3556 Å (log gf = -0.96, χ = 0.54 eV)
 ⋮
 Fe I 8987.3527 Å (log gf = -0.92, χ = 5.1 eV)
 Fe I 8989.6036 Å (log gf = -2.27, χ = 4.99 eV)
 Mg I 8991.4958 Å (log gf = -2.47, χ = 5.93 eV)
 Ti I 8991.9147 Å (log gf = -1.56, χ = 1.73 eV)
 Fe II 8992.8729 Å (log gf = -2.5, χ = 6.23 eV)
 Mg I 8994.1606 Å (log gf = -2.0, χ = 5.93 eV)
 Si I 8995.8143 Å (log gf = -2.08, χ = 6.22 eV)
 Fe I 8997.0972 Å (log gf = -3.19, χ = 3.27 eV)
 Mg I 8999.623 Å (log gf = -1.77, χ = 5.93 eV)</code></pre><h2 id="Specifying-abundances"><a class="docs-heading-anchor" href="#Specifying-abundances">Specifying abundances</a><a id="Specifying-abundances-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-abundances" title="Permalink"></a></h2><p>To specify the abundances for a synthesis, the <code>M_H</code> and <code>alpha_H</code> keyword arguments specify the default metallicity and alpha enhancement, respectively.  To specify the hydrogen-relative abundances of individual elements, pass their atomic symbol as a keyword argument to <code>synth</code>. There are unavoidable subtleties in abundance notation, so see <a href="#Abundances">Abundances</a> for the messy details. For now, just know that the &quot;metallicity&quot; of a given mixture is not necessarily the same as the input <code>M_H</code> keyword argument, depending on how &quot;metallicity&quot; is defined.</p><h2 id="synth-example"><a class="docs-heading-anchor" href="#synth-example">A more complex example</a><a id="synth-example-1"></a><a class="docs-heading-anchor-permalink" href="#synth-example" title="Permalink"></a></h2><p>Let&#39;s synthesize another spectrum with the linelist we&#39;ve selected, and with specific abundances. We&#39;ll also demonstrate a few more keyword arguments to <a href="../../../API/#Korg.synth"><code>synth</code></a>, but you can <a href="../../../API/#Korg.synth">read the docs</a> for more.</p><pre><code class="language-julia hljs">λs, flux, cntm = synth(; Teff=5777, logg=4.44, wavelengths=(5000, 5050), # what we had before
                       linelist=vald_lines, # use the linelist we selected
                       M_H=-1.1, alpha_H=-1.0, # metal-poor, mildly alpha-enhanced star
                       C=-0.5, # [C/H] = -0.5 dex (carbon enhanced)
                       R=20000, # Simulate an LSF with resolving power, R = λ/Δλ of 20,000
                       vsini=7, # projected rotational velocity of 7 km/s
                       vmic=2) # microturbulence of 2 km/s
plot(λs, flux, &quot;k-&quot;)
xlabel(&quot;λ [Å]&quot;)
ylabel(&quot;Flux&quot;)</code></pre><img src="49dce1f1.png" alt="Example block output"/><h1 id="Going-deeper:-synthesize"><a class="docs-heading-anchor" href="#Going-deeper:-synthesize">Going deeper: <code>synthesize</code></a><a id="Going-deeper:-synthesize-1"></a><a class="docs-heading-anchor-permalink" href="#Going-deeper:-synthesize" title="Permalink"></a></h1><p>The <a href="../../../API/#Korg.synth"><code>synth</code></a> function provides a convenient interface that aims to cover most use cases, but in some circumstances you might want more control. The <a href="../../../API/#Korg.synthesize"><code>synthesize</code></a> function is the more low-level function upon which <a href="../../../API/#Korg.synth"><code>synth</code></a> is built. <a href="../../../API/#Korg.synthesize"><code>synthesize</code></a> has a few required arguments.  Its signature is:</p><pre><code class="nohighlight hljs">synthesize(atm, linelist, A_X, wavelengths...; kwargs...)</code></pre><p><a href="../../../API/#Korg.synthesize"><code>synthesize</code></a> takes a model atmosphere, a linelist, a vector of abundances, and parameters specifying the wavelengths to use as required arguments. We&#39;ve covered linelists above, so let&#39;s take abundances and model atmospheres in turn.</p><h2 id="Abundances"><a class="docs-heading-anchor" href="#Abundances">Abundances</a><a id="Abundances-1"></a><a class="docs-heading-anchor-permalink" href="#Abundances" title="Permalink"></a></h2><p>For the sake of unambiguity, <a href="../../../API/#Korg.synthesize"><code>synthesize</code></a> takes a vector of abundances, <code>A_X</code>, as an argument for all elements from H to U. Note that unlike the <a href="../../../API/#Korg.synth"><code>synth</code></a> function (by default), these are <em>not</em> solar relative. They are in &quot;standard&quot; <span>$A(X)$</span> format, <span>$A(X) = \log_{10} \left( \frac{n_X}{n_H} \right)$</span>. You can of course construct this vector yourself, but it&#39;s often easier to use the <a href="../../../API/#Korg.format_A_X"><code>format_A_X</code></a> function to do it for you. The interface for <a href="../../../API/#Korg.format_A_X"><code>format_A_X</code></a> is similar to that of <a href="../../../API/#Korg.synth"><code>synth</code></a>, but a tiny bit more explicit.  Instead of specifying abundances of individual elements with keyword arguments, we pass a dictionary of element symbols and abundances.</p><pre><code class="language-julia hljs">metal_poor_A_X = format_A_X(-0.5) # [M/H] = -1/2
alpha_rich_A_X = format_A_X(0, 0.5) # all [M/H] = 0, but [alpha/H] = 0.5
Ni_enriched_A_X = format_A_X(Dict(&quot;Ni&quot; =&gt; 1.0)) # all [M/H] = 0, except [Ni/H] = 1.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">92-element Vector{Float64}:
 12.0
 10.922
  1.04
  1.21
  2.7
  8.51
  7.94
  8.76
  4.4
  8.15
  ⋮
 -5.0
 -5.0
 -5.0
 -5.0
 -5.0
 -5.0
  0.09
 -5.0
 -0.5</code></pre><h2 id="Model-Atmosphere"><a class="docs-heading-anchor" href="#Model-Atmosphere">Model Atmosphere</a><a id="Model-Atmosphere-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Atmosphere" title="Permalink"></a></h2><p>As mentioned above, Korg can interpolate from a grid of MARCS model atmospheres that it is shipped with using the <a href="../../../API/#Korg.interpolate_marcs"><code>interpolate_marcs</code></a> function. These are primarily <a href="https://www.sdss4.org/dr17/irspec/apogee-libraries/">those generated for the Sloan Digital Sky Survey (SDSS)</a>, but the grid has been augmented with more atmospheres at lower metallicities. See <a href="../../../API/#Korg.interpolate_marcs">the docs</a> for more details on the models and how they get interpolated. We can create a model atmosphere object to pass to <a href="../../../API/#Korg.synthesize"><code>synthesize</code></a> like this:</p><pre><code class="language-julia hljs">atm = interpolate_marcs(5777, 4.44, Ni_enriched_A_X) # solar Teff and logg, Ni-enriched abundances</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Korg.PlanarAtmosphere{Float64, Float64, Float64, Float64, Float64} with 56 layers</code></pre><p>Korg will look at your abundance vector and translate it into the appropriate parameters for the atmosphere grid.  It&#39;s possible to bypass this and specify the abundance parameters directly, but it&#39;s easy to mess up and not recommended.</p><p>If you have a model atmosphere file you want to use instead of Korg&#39;s internal grid, you can read it in with <a href="../../../API/#Korg.read_model_atmosphere"><code>Korg.read_model_atmosphere</code></a>.</p><h2 id="Putting-it-all-together"><a class="docs-heading-anchor" href="#Putting-it-all-together">Putting it all together</a><a id="Putting-it-all-together-1"></a><a class="docs-heading-anchor-permalink" href="#Putting-it-all-together" title="Permalink"></a></h2><p>Now we can synthesize a stellar spectrum by passing the linelist and atmosphere to <a href="../../../API/#Korg.synthesize"><code>synthesize</code></a>, along with upper and lower wavelengths (in Å). Korg uses wavelengths <em>in vacuo</em>, but you can use <a href="../../../API/#Korg.air_to_vacuum"><code>Korg.air_to_vacuum</code></a> and <a href="../../../API/#Korg.vacuum_to_air"><code>Korg.vacuum_to_air</code></a> to convert back and forth.</p><pre><code class="language-julia hljs">res = synthesize(atm, vald_lines, format_A_X(0), (4000, 4015));</code></pre><p>The object returned by <a href="../../../API/#Korg.synthesize"><code>synthesize</code></a> is a <a href="../../../devdocs/#Korg.SynthesisResult"><code>Korg.SynthesisResult</code></a>, which contains lots of information. As with <a href="../../../API/#Korg.synth"><code>synth</code></a>, the wavelengths, flux, and continuum are available, though note that in a <a href="../../../devdocs/#Korg.SynthesisResult"><code>Korg.SynthesisResult</code></a>, the flux has not had the continuum divided out (i.e. the spectrum has not been continuum normalized, or rectified).</p><pre><code class="language-julia hljs">plot(res.wavelengths, res.flux, &quot;k-&quot;) # &quot;./&quot; is how you do element-wise division in Julia
xlabel(L&quot;$\lambda$ [Å]&quot;)
ylabel(&quot;flux [erg/s/cm^2/Å]&quot;)</code></pre><img src="406b845f.png" alt="Example block output"/><h2 id="Per-species-number-densities"><a class="docs-heading-anchor" href="#Per-species-number-densities">Per-species number densities</a><a id="Per-species-number-densities-1"></a><a class="docs-heading-anchor-permalink" href="#Per-species-number-densities" title="Permalink"></a></h2><p>One of the pieces of information in a <a href="../../../devdocs/#Korg.SynthesisResult"><code>Korg.SynthesisResult</code></a> is the per-species number densities, which are stored as a dictionary mapping <a href="../../../devdocs/#Korg.Species"><code>Korg.Species</code></a> objects to arrays with one entry for each layer in the model atmosphere.</p><pre><code class="language-julia hljs">temps = Korg.get_temps(atm)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">56-element Vector{Float64}:
  4038.537325011156
  4074.5917315873266
  4118.2956801999435
  4163.278574411633
  4208.868847394864
  4254.718143515409
  4300.778742918721
  4346.988719938422
  4393.318376593419
  4439.617393246222
     ⋮
  8157.921295493615
  8361.529785652685
  8540.703790504303
  8702.690856410749
  8990.697902698077
  9257.127912855482
  9513.759200768995
  9767.790673812302
 10024.243776981975</code></pre><p>These strings represent different species. Below, we pass them to Korg.Species to construct a Species object.</p><pre><code class="language-julia hljs">for spec in [&quot;H I&quot;, &quot;H II&quot;, &quot;O I&quot;, &quot;OH&quot;]
    plot(temps, res.number_densities[Korg.Species(spec)]; label=spec)
end

legend()
yscale(&quot;log&quot;)
xlabel(L&quot;$T$ [K]&quot;)
ylabel(L&quot;$n$ [cm$^{-3}$]&quot;)</code></pre><img src="a1199a27.png" alt="Example block output"/><h2 id="The-absorption-coefficient"><a class="docs-heading-anchor" href="#The-absorption-coefficient">The absorption coefficient</a><a id="The-absorption-coefficient-1"></a><a class="docs-heading-anchor-permalink" href="#The-absorption-coefficient" title="Permalink"></a></h2><p>Another piece of information in a <a href="../../../devdocs/#Korg.SynthesisResult"><code>Korg.SynthesisResult</code></a> is the absorption coefficient, α, in units of cm^-1.</p><pre><code class="language-julia hljs">plot(res.wavelengths, res.alpha&#39;); # res.alpha&#39; is the adjoint of res.alpha.
yscale(&quot;log&quot;)
xlabel(L&quot;$\lambda$ [Å]&quot;)
ylabel(L&quot;$\alpha$ [cm$^{-1}$]&quot;);</code></pre><img src="880a3ea6.png" alt="Example block output"/><h1 id="Post-processing-your-spectrum"><a class="docs-heading-anchor" href="#Post-processing-your-spectrum">Post-processing your spectrum</a><a id="Post-processing-your-spectrum-1"></a><a class="docs-heading-anchor-permalink" href="#Post-processing-your-spectrum" title="Permalink"></a></h1><p>Given a synthesized spectrum, you may want to manipulate it further to make it look more like real data. Korg provides functions for applying a line-spread function (LSF) and rotational broadening to a spectrum. Note that <a href="#synth-example">the example above</a> demonstrates shortcuts to do this with <a href="../../../API/#Korg.synth"><code>synth</code></a>.</p><h2 id="LSF"><a class="docs-heading-anchor" href="#LSF">Line-spread function (LSF)</a><a id="LSF-1"></a><a class="docs-heading-anchor-permalink" href="#LSF" title="Permalink"></a></h2><p>Korg provides two ways of applying an LSF to a spectrum. The first, <a href="../../../API/#Korg.apply_LSF"><code>Korg.apply_LSF</code></a>, is simpler (this is what <a href="../../../API/#Korg.synth"><code>synth</code></a> does). It returns a new flux vector and does not modify the wavelength sampling.</p><pre><code class="language-julia hljs">R = 10_000 # the resolving power, R = λ/Δλ
low_res_flux = Korg.apply_LSF(res.flux, res.wavelengths, R)

plot(res.wavelengths, res.flux, &quot;k-&quot;; label=&quot;high-res&quot;)
plot(res.wavelengths, low_res_flux, &quot;C1-&quot;; label=&quot;low-res&quot;)
legend()
xlabel(L&quot;$\lambda$ [Å]&quot;)
ylabel(&quot;flux [erg/s/cm^2/Å]&quot;)</code></pre><img src="ebea079a.png" alt="Example block output"/><p>The second way of applying an LSF is slightly more powerful: <a href="../../../API/#Korg.compute_LSF_matrix"><code>Korg.compute_LSF_matrix</code></a>. This function computes an efficiently-represented sparse matrix that transforms an infinite-resolution flux vector to a low-resolution flux vector, simultaneously resampling the wavelengths. This saves a lot of computing time if you need to apply the same LSF to many spectra.</p><pre><code class="language-julia hljs">new_wavelengths = 4000:0.1:4015
LSF = Korg.compute_LSF_matrix(res.wavelengths, new_wavelengths, R)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">151×1501 LinearAlgebra.Adjoint{Float64, SparseArrays.SparseMatrixCSC{Float64, Int64}} with 20098 stored entries:
⎡⠉⠛⠛⠛⠛⠒⠒⠶⠶⠶⠦⠤⢤⣤⣤⣤⣀⣀⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎤
⎣⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⠉⠉⠉⠛⠛⠛⠓⠒⠲⠶⠶⠶⠤⠤⣤⣤⣤⣤⣀⎦</code></pre><p>The <code>LSF</code> object is a sparse matrix that we can use to transform the high-resolution flux vector (or any other computed on the same wavelength grid)</p><pre><code class="language-julia hljs">resampled_low_res_flux = LSF * res.flux

plot(res.wavelengths, low_res_flux, &quot;C1-&quot;; label=&quot;low-res&quot;)
plot(new_wavelengths, resampled_low_res_flux, &quot;C2-&quot;; label=&quot;low-res (resampled wavelengths)&quot;)
legend()
xlabel(L&quot;$\lambda$ [Å]&quot;)
ylabel(&quot;flux [erg/s/cm^4/Å]&quot;)</code></pre><img src="5c11dc3e.png" alt="Example block output"/><h3 id="Varying-LSFs"><a class="docs-heading-anchor" href="#Varying-LSFs">Varying LSFs</a><a id="Varying-LSFs-1"></a><a class="docs-heading-anchor-permalink" href="#Varying-LSFs" title="Permalink"></a></h3><p>If your LSF has a Gaussian width that varies with wavelength, that&#39;s no problem!  Just pass a function that maps from wavelength (in Å) to R.</p><pre><code class="language-julia hljs">resolution(λ) = 10_000 + 2000 * sin(λ) # R varying with wavelength
crazy_lsf_flux = Korg.apply_LSF(res.flux, res.wavelengths, resolution)

plot(res.wavelengths, res.flux, &quot;k-&quot;; label=&quot;high-res&quot;)
plot(res.wavelengths, low_res_flux, &quot;C1-&quot;; label=&quot;low-res (constant LSF)&quot;)
plot(res.wavelengths, crazy_lsf_flux, &quot;C3-&quot;; label=&quot;low-res (varying LSF)&quot;)
legend()
xlabel(L&quot;$\lambda$ [Å]&quot;)
ylabel(&quot;flux [erg/s/cm^4/Å]&quot;)</code></pre><img src="bdd2777d.png" alt="Example block output"/><h2 id="Rotational-broadening"><a class="docs-heading-anchor" href="#Rotational-broadening">Rotational broadening</a><a id="Rotational-broadening-1"></a><a class="docs-heading-anchor-permalink" href="#Rotational-broadening" title="Permalink"></a></h2><p>To apply the broadening resulting from differential line-of-sight velocity across the face of the star due to rotation, you can use <a href="../../../devdocs/#Korg.apply_rotation"><code>Korg.apply_rotation</code></a>.</p><pre><code class="language-julia hljs">vsini = 30 # km/s
rot_flux = Korg.apply_rotation(res.flux, res.wavelengths, 15)

plot(new_wavelengths, LSF * res.flux, &quot;C1-&quot;; label=&quot;original&quot;)
plot(new_wavelengths, LSF * rot_flux, &quot;C4-&quot;; label=&quot;with rotation&quot;)
legend()
xlabel(L&quot;$\lambda$ [Å]&quot;)
ylabel(&quot;flux [erg/s/cm^4/Å]&quot;)</code></pre><img src="26e4f1ee.png" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Upgrading/">« Upgrading to v1.0</a><a class="docs-footer-nextpage" href="../Direct Fitting/">Direct Fitting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 2 September 2025 14:04">Tuesday 2 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
